<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FleetFlow â€” Fleet Management</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESET & VARIABLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
:root {
  --bg:          #080b14;
  --bg2:         #0d1121;
  --bg3:         #111827;
  --surface:     rgba(255,255,255,0.035);
  --surface2:    rgba(255,255,255,0.06);
  --border:      rgba(255,255,255,0.07);
  --border2:     rgba(255,255,255,0.12);
  --brand:       #3b82f6;
  --brand2:      #60a5fa;
  --brand-glow:  rgba(59,130,246,0.25);
  --green:       #22c55e;
  --amber:       #f59e0b;
  --red:         #ef4444;
  --violet:      #8b5cf6;
  --cyan:        #06b6d4;
  --pink:        #ec4899;
  --text1:       #647c95;
  --text2:       #94a3b8;
  --text3:       #475569;
  --font-head:   'Syne', sans-serif;
  --font-body:   'Outfit', sans-serif;
  --font-mono:   'JetBrains Mono', monospace;
  --radius:      14px;
  --sidebar-w:   230px;
}
html, body { height: 100%; }
body {
  font-family: var(--font-body);
  background: var(--bg);
  color: var(--text1);
  overflow-x: hidden;
}
body::before {
  content: '';
  position: fixed; inset: 0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='1'/%3E%3C/svg%3E");
  opacity: 0.025; pointer-events: none; z-index: 999;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SIDEBAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sidebar {
  position: fixed; left: 0; top: 0; bottom: 0;
  width: var(--sidebar-w);
  background: rgba(13,17,33,0.97);
  border-right: 1px solid var(--border);
  display: flex; flex-direction: column;
  padding: 28px 14px;
  gap: 3px;
  backdrop-filter: blur(20px);
  z-index: 40;
  animation: slideInLeft 0.45s ease both;
}
@keyframes slideInLeft {
  from { transform: translateX(-100%); opacity: 0; }
  to   { transform: translateX(0); opacity: 1; }
}
.logo {
  font-family: var(--font-head);
  font-size: 20px; font-weight: 800;
  color: var(--brand2); letter-spacing: -0.5px;
  padding: 4px 12px 22px;
  display: flex; align-items: center; gap: 8px;
}
.logo .logo-dot { color: var(--text1); }
.nav-section-label {
  font-size: 10px; color: var(--text3);
  text-transform: uppercase; letter-spacing: 1.5px;
  padding: 12px 14px 4px;
}
.nav-item {
  display: flex; align-items: center; gap: 10px;
  padding: 10px 14px;
  border-radius: 10px;
  font-size: 14px; font-weight: 500;
  color: var(--text3); cursor: pointer;
  transition: all 0.18s;
  border: 1px solid transparent;
  user-select: none;
}
.nav-item:hover { color: var(--text2); background: var(--surface); }
.nav-item.active {
  color: var(--brand2);
  background: rgba(59,130,246,0.1);
  border-color: rgba(59,130,246,0.2);
}
.nav-item .icon { font-size: 16px; width: 20px; text-align: center; }
.nav-divider { height: 1px; background: var(--border); margin: 8px 0; }
.user-card {
  margin-top: auto;
  padding: 12px 14px; border-radius: 10px;
  background: var(--surface); border: 1px solid var(--border);
  display: flex; align-items: center; gap: 10px; cursor: pointer;
  transition: border-color 0.2s;
}
.user-card:hover { border-color: var(--border2); }
.user-card-arrow { font-size:10px; color:var(--text3); margin-left:auto; flex-shrink:0; transition:transform 0.2s; }
.user-card.open .user-card-arrow { transform:rotate(180deg); }

/* â”€â”€ Dropup menu â”€â”€ */
.dropup-wrap { position:relative; margin-top:auto; }
.dropup-menu {
  position:absolute; bottom:calc(100% + 8px); left:0; right:0;
  background:#0c1020; border:1px solid var(--border2);
  border-radius:12px; padding:6px; z-index:200;
  box-shadow:0 -12px 40px rgba(0,0,0,0.55);
  display:none; animation:dropupIn 0.22s cubic-bezier(0.22,1,0.36,1) both;
}
@keyframes dropupIn {
  from{opacity:0;transform:translateY(8px);}
  to{opacity:1;transform:translateY(0);}
}
.dropup-menu.open { display:block; }
.dropup-head {
  display:flex; align-items:center; gap:10px;
  padding:10px 10px 12px; border-bottom:1px solid var(--border);
}
.dropup-name { font-size:13px; font-weight:700; color:var(--text1); }
.dropup-email { font-size:11px; color:var(--text3); margin-top:1px; }
.dropup-item {
  display:flex; align-items:center; gap:10px;
  width:100%; padding:9px 10px; border-radius:8px;
  background:none; border:none; cursor:pointer;
  font-size:13px; font-family:var(--font-body); color:var(--text2);
  transition:background 0.15s,color 0.15s; text-align:left;
}
.dropup-item:hover { background:var(--surface2); color:var(--text1); }
.dropup-item.danger { color:#f87171; }
.dropup-item.danger:hover { background:rgba(239,68,68,0.1); }
.dropup-sep { height:1px; background:var(--border); margin:4px 0; }

/* â”€â”€ Toast â”€â”€ */
.ff-toast {
  position:fixed; bottom:24px; right:24px; z-index:9999;
  display:flex; align-items:center; gap:10px;
  padding:12px 18px; border-radius:12px;
  font-size:13px; font-weight:600; font-family:var(--font-body);
  box-shadow:0 8px 32px rgba(0,0,0,0.45);
  transition:opacity 0.3s,transform 0.3s;
  opacity:0; transform:translateY(12px); pointer-events:none;
}
.ff-toast.show { opacity:1; transform:translateY(0); }
.ff-toast.success { background:rgba(34,197,94,0.15); border:1px solid rgba(34,197,94,0.3); color:#4ade80; }
.ff-toast.error   { background:rgba(239,68,68,0.15);  border:1px solid rgba(239,68,68,0.3);  color:#f87171; }
.avatar {
  width: 34px; height: 34px; border-radius: 50%;
  background: linear-gradient(135deg, #3b82f6, #8b5cf6);
  display: flex; align-items: center; justify-content: center;
  font-size: 12px; font-weight: 700; color: #fff; flex-shrink: 0;
}
.user-name { font-size: 13px; font-weight: 600; color: var(--text1); }
.user-role { font-size: 11px; color: var(--text3); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN / PAGES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.main { margin-left: var(--sidebar-w); padding: 32px 28px; min-height: 100vh; }
.page { display: none; }
.page.active { display: block; animation: fadeUp 0.4s ease both; }
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(14px); }
  to   { opacity: 1; transform: translateY(0); }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   COMMON PAGE HEADER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.page-header {
  display: flex; justify-content: space-between; align-items: center;
  margin-bottom: 28px;
}
.page-title {
  font-family: var(--font-head);
  font-size: 26px; font-weight: 800;
  color: var(--text1); letter-spacing: -0.5px;
}
.page-sub { font-size: 13px; color: var(--text3); margin-top: 4px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUTTONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.btn { padding: 10px 20px; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer; font-family: var(--font-body); transition: all 0.18s; border: none; }
.btn-primary { background: linear-gradient(135deg, #3b82f6, #60a5fa); color: #fff; box-shadow: 0 4px 20px rgba(59,130,246,0.35); }
.btn-primary:hover { transform: translateY(-1px); box-shadow: 0 6px 28px rgba(59,130,246,0.5); }
.btn-primary:active { transform: scale(0.97); }
.btn-ghost { background: transparent; border: 1px solid var(--border2); color: var(--text3); }
.btn-ghost:hover { color: var(--text2); border-color: var(--border2); background: var(--surface); }
.btn-danger { background: rgba(239,68,68,0.15); border: 1px solid rgba(239,68,68,0.3); color: var(--red); }
.btn-success { background: rgba(34,197,94,0.15); border: 1px solid rgba(34,197,94,0.3); color: var(--green); }
.btn-sm { padding: 6px 14px; font-size: 12px; border-radius: 8px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CARDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius); padding: 22px;
  transition: border-color 0.2s, box-shadow 0.2s;
}
.card:hover { border-color: rgba(59,130,246,0.15); }
.card-head {
  display: flex; justify-content: space-between; align-items: center;
  margin-bottom: 18px;
}
.card-head h3 {
  font-family: var(--font-head); font-size: 15px; font-weight: 700; color: var(--text1);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATS GRID
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.stats-grid { display: grid; grid-template-columns: repeat(4,1fr); gap: 14px; margin-bottom: 22px; }
.stats-grid-3 { display: grid; grid-template-columns: repeat(3,1fr); gap: 14px; margin-bottom: 22px; }
.stat-card {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: var(--radius); padding: 20px;
  position: relative; overflow: hidden;
  animation: riseIn 0.5s ease both;
  transition: border-color 0.2s, box-shadow 0.2s;
}
.stat-card:hover { border-color: rgba(59,130,246,0.25); box-shadow: 0 0 30px rgba(59,130,246,0.08); }
.stat-card::after {
  content: ''; position: absolute; top: -40px; right: -40px;
  width: 100px; height: 100px;
  background: radial-gradient(circle, rgba(59,130,246,0.07), transparent 70%);
  border-radius: 50%;
}
.stat-card:nth-child(1) { animation-delay:.08s }
.stat-card:nth-child(2) { animation-delay:.14s }
.stat-card:nth-child(3) { animation-delay:.20s }
.stat-card:nth-child(4) { animation-delay:.26s }
@keyframes riseIn {
  from { opacity:0; transform:translateY(20px); }
  to   { opacity:1; transform:translateY(0); }
}
.stat-icon { font-size: 22px; margin-bottom: 12px; }
.stat-value { font-family: var(--font-head); font-size: 30px; font-weight: 800; color: var(--text1); letter-spacing: -1px; line-height: 1; }
.stat-label { font-size: 12px; color: var(--text3); text-transform: uppercase; letter-spacing: 1px; margin-top: 6px; }
.stat-change { font-size: 12px; margin-top: 8px; }
.stat-change.up   { color: var(--green); }
.stat-change.down { color: var(--amber); }
.stat-change.bad  { color: var(--red); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GRIDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.grid-2   { display: grid; grid-template-columns: 1fr 1fr;     gap: 16px; margin-bottom: 16px; }
.grid-3   { display: grid; grid-template-columns: 3fr 2fr;     gap: 16px; margin-bottom: 16px; }
.grid-3-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; margin-bottom: 16px; }
.mb16 { margin-bottom: 16px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BADGES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.badge { font-size: 11px; padding: 3px 10px; border-radius: 20px; font-weight: 600; letter-spacing: 0.3px; display: inline-block; }
.badge-brand  { background: rgba(59,130,246,0.15); color: var(--brand2);  border: 1px solid rgba(59,130,246,0.3); }
.badge-green  { background: rgba(34,197,94,0.12);  color: var(--green);   border: 1px solid rgba(34,197,94,0.25); }
.badge-amber  { background: rgba(245,158,11,0.12); color: var(--amber);   border: 1px solid rgba(245,158,11,0.25); }
.badge-red    { background: rgba(239,68,68,0.12);  color: var(--red);     border: 1px solid rgba(239,68,68,0.25); }
.badge-violet { background: rgba(139,92,246,0.12); color: var(--violet);  border: 1px solid rgba(139,92,246,0.25); }
.badge-cyan   { background: rgba(6,182,212,0.12);  color: var(--cyan);    border: 1px solid rgba(6,182,212,0.25); }
.badge-gray   { background: rgba(255,255,255,0.06); color: var(--text3);  border: 1px solid var(--border2); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TABLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.table-wrap { overflow-x: auto; }
table { width: 100%; border-collapse: collapse; }
thead th {
  text-align: left; font-size: 11px; color: var(--text3);
  text-transform: uppercase; letter-spacing: 1px;
  padding: 10px 14px; border-bottom: 1px solid var(--border);
  font-family: var(--font-body); font-weight: 600;
}
tbody td { padding: 13px 14px; font-size: 14px; color: var(--text2); border-bottom: 1px solid rgba(255,255,255,0.04); vertical-align: middle; }
tbody tr:last-child td { border-bottom: none; }
tbody tr { transition: background 0.15s; }
tbody tr:hover td { background: rgba(255,255,255,0.025); color: var(--text1); }
.td-mono { font-family: var(--font-mono); font-size: 12px; }
.td-name { color: var(--text1) !important; font-weight: 600; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VEHICLE CARD GRID
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.vehicle-grid { display: grid; grid-template-columns: repeat(auto-fill,minmax(260px,1fr)); gap: 16px; }
.vehicle-card {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: var(--radius); padding: 20px;
  cursor: pointer; transition: all 0.2s;
  animation: riseIn 0.5s ease both;
  position: relative; overflow: hidden;
}
.vehicle-card:hover { border-color: rgba(59,130,246,0.3); transform: translateY(-2px); box-shadow: 0 8px 32px rgba(0,0,0,0.3); }
.vehicle-card-glow {
  position: absolute; top: -30px; right: -30px; width: 80px; height: 80px;
  border-radius: 50%; pointer-events: none;
}
.vc-type { font-size: 11px; color: var(--text3); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; }
.vc-id { font-family: var(--font-mono); font-size: 15px; color: var(--text1); font-weight: 600; margin-bottom: 4px; }
.vc-model { font-size: 13px; color: var(--text2); margin-bottom: 16px; }
.vc-stat-row { display: flex; gap: 16px; margin-bottom: 14px; }
.vc-stat { flex: 1; }
.vc-stat-val { font-size: 15px; font-weight: 700; color: var(--text1); }
.vc-stat-lbl { font-size: 10px; color: var(--text3); text-transform: uppercase; letter-spacing: 0.8px; margin-top: 2px; }
.vc-fuel-bar { height: 4px; background: rgba(255,255,255,0.06); border-radius: 3px; overflow: hidden; margin-bottom: 14px; }
.vc-fuel-fill { height: 100%; border-radius: 3px; transition: width 1s cubic-bezier(0.22,1,0.36,1); }
.vc-footer { display: flex; justify-content: space-between; align-items: center; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROGRESS BARS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.prog-track { height: 5px; background: rgba(255,255,255,0.06); border-radius: 4px; overflow: hidden; }
.prog-fill { height: 100%; border-radius: 4px; width: 0; transition: width 1.2s cubic-bezier(0.22,1,0.36,1); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ANIMATED LIST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.al-container { position: relative; }
.al-scroll {
  max-height: 320px; overflow-y: auto;
  padding: 2px 2px 8px;
  scrollbar-width: thin;
  scrollbar-color: rgba(59,130,246,0.3) transparent;
}
.al-scroll::-webkit-scrollbar { width: 4px; }
.al-scroll::-webkit-scrollbar-thumb { background: rgba(59,130,246,0.3); border-radius: 4px; }
.al-grad-top, .al-grad-bot {
  position: absolute; left: 0; right: 0; pointer-events: none; transition: opacity 0.3s;
}
.al-grad-top { top: 0; height: 40px; background: linear-gradient(to bottom, var(--bg2), transparent); opacity: 0; }
.al-grad-bot { bottom: 0; height: 60px; background: linear-gradient(to top, var(--bg2), transparent); opacity: 1; }
.al-item { margin-bottom: 8px; opacity: 0; transform: translateX(-16px) scale(0.97); transition: opacity 0.28s ease, transform 0.28s cubic-bezier(0.22,1,0.36,1); }
.al-item.visible { opacity: 1; transform: translateX(0) scale(1); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BAR CHART
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.bar-chart { display: flex; gap: 8px; align-items: flex-end; height: 90px; }
.bar-col { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 5px; }
.bar-val { font-size: 10px; color: var(--text3); font-family: var(--font-mono); }
.bar-track { width: 100%; flex: 1; background: rgba(255,255,255,0.05); border-radius: 5px; overflow: hidden; display: flex; align-items: flex-end; }
.bar-fill { width: 100%; background: linear-gradient(to top, #3b82f6, #60a5fa); border-radius: 5px; height: 0; transition: height 1s cubic-bezier(0.22,1,0.36,1); }
.bar-fill.green { background: linear-gradient(to top, #22c55e, #4ade80); }
.bar-fill.amber { background: linear-gradient(to top, #f59e0b, #fbbf24); }
.bar-day { font-size: 10px; color: var(--text3); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TIMELINE (Maintenance)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.timeline { display: flex; flex-direction: column; gap: 0; }
.tl-item {
  display: flex; gap: 16px; padding-bottom: 20px;
  position: relative;
  animation: riseIn 0.4s ease both;
}
.tl-item:last-child { padding-bottom: 0; }
.tl-left { display: flex; flex-direction: column; align-items: center; flex-shrink: 0; width: 36px; }
.tl-dot {
  width: 36px; height: 36px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 15px; flex-shrink: 0; border: 2px solid transparent;
  transition: transform 0.2s;
}
.tl-item:hover .tl-dot { transform: scale(1.1); }
.tl-line { width: 2px; flex: 1; background: var(--border); margin-top: 4px; min-height: 16px; }
.tl-item:last-child .tl-line { display: none; }
.tl-content { flex: 1; padding-top: 6px; }
.tl-title { font-size: 14px; font-weight: 600; color: var(--text1); margin-bottom: 3px; }
.tl-sub { font-size: 12px; color: var(--text3); }
.tl-date { font-size: 11px; color: var(--text3); font-family: var(--font-mono); margin-top: 4px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DRIVER CARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.driver-grid { display: grid; grid-template-columns: repeat(auto-fill,minmax(220px,1fr)); gap: 16px; }
.driver-card {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: var(--radius); padding: 22px; text-align: center;
  cursor: pointer; transition: all 0.2s;
  animation: riseIn 0.5s ease both;
}
.driver-card:hover { border-color: rgba(59,130,246,0.3); transform: translateY(-2px); box-shadow: 0 8px 32px rgba(0,0,0,0.3); }
.driver-avatar {
  width: 56px; height: 56px; border-radius: 50%;
  margin: 0 auto 12px;
  display: flex; align-items: center; justify-content: center;
  font-size: 20px; font-weight: 700; color: #fff;
}
.driver-name-card { font-family: var(--font-head); font-size: 15px; font-weight: 700; color: var(--text1); margin-bottom: 4px; }
.driver-meta { font-size: 12px; color: var(--text3); margin-bottom: 14px; }
.driver-stats { display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid var(--border); border-bottom: 1px solid var(--border); margin-bottom: 14px; }
.driver-stat-val { font-family: var(--font-head); font-size: 17px; font-weight: 800; color: var(--text1); }
.driver-stat-lbl { font-size: 10px; color: var(--text3); text-transform: uppercase; letter-spacing: 0.8px; }
.rating-stars { color: var(--amber); font-size: 13px; margin-bottom: 6px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EXPENSE CHART / DONUT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.donut-wrap { position: relative; width: 140px; height: 140px; margin: 0 auto 20px; }
.donut-svg { transform: rotate(-90deg); }
.donut-center {
  position: absolute; inset: 0;
  display: flex; flex-direction: column; align-items: center; justify-content: center;
}
.donut-val { font-family: var(--font-head); font-size: 20px; font-weight: 800; color: var(--text1); }
.donut-lbl { font-size: 10px; color: var(--text3); text-transform: uppercase; letter-spacing: 1px; }
.legend-list { list-style: none; display: flex; flex-direction: column; gap: 10px; }
.legend-item { display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text2); }
.legend-dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
.legend-pct { margin-left: auto; font-family: var(--font-mono); font-size: 12px; color: var(--text3); }



/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SETTINGS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.settings-layout { display: grid; grid-template-columns: 200px 1fr; gap: 24px; }
.settings-nav { display: flex; flex-direction: column; gap: 4px; }
.settings-nav-item {
  padding: 10px 14px; border-radius: 10px;
  font-size: 14px; color: var(--text3); cursor: pointer;
  transition: all 0.18s; border: 1px solid transparent;
  display: flex; align-items: center; gap: 8px;
}
.settings-nav-item:hover { color: var(--text2); background: var(--surface); }
.settings-nav-item.active { color: var(--brand2); background: rgba(59,130,246,0.1); border-color: rgba(59,130,246,0.2); }
.settings-section { display: none; }
.settings-section.active { display: block; }
.settings-group { margin-bottom: 28px; }
.settings-group-title { font-family: var(--font-head); font-size: 13px; font-weight: 700; color: var(--text1); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 14px; padding-bottom: 8px; border-bottom: 1px solid var(--border); }
.setting-row {
  display: flex; justify-content: space-between; align-items: center;
  padding: 14px 0; border-bottom: 1px solid rgba(255,255,255,0.04);
}
.setting-row:last-child { border-bottom: none; }
.setting-info { flex: 1; }
.setting-label { font-size: 14px; color: var(--text1); font-weight: 500; }
.setting-desc  { font-size: 12px; color: var(--text3); margin-top: 2px; }
/* Toggle */
.toggle { position: relative; width: 42px; height: 24px; flex-shrink: 0; }
.toggle input { opacity: 0; width: 0; height: 0; }
.toggle-slider {
  position: absolute; inset: 0; background: rgba(255,255,255,0.1);
  border-radius: 24px; cursor: pointer; border: 1px solid var(--border2);
  transition: background 0.25s;
}
.toggle-slider::before {
  content: ''; position: absolute; left: 3px; top: 3px;
  width: 16px; height: 16px; border-radius: 50%;
  background: var(--text3); transition: transform 0.25s, background 0.25s;
}
.toggle input:checked + .toggle-slider { background: rgba(59,130,246,0.3); border-color: rgba(59,130,246,0.5); }
.toggle input:checked + .toggle-slider::before { transform: translateX(18px); background: var(--brand2); }
/* Input */
.setting-input {
  background: rgba(255,255,255,0.05); border: 1px solid var(--border2);
  border-radius: 8px; padding: 8px 12px; color: var(--text1);
  font-size: 13px; font-family: var(--font-body); width: 200px;
  outline: none; transition: border-color 0.2s;
}
.setting-input:focus { border-color: rgba(59,130,246,0.5); box-shadow: 0 0 0 3px rgba(59,130,246,0.1); }
.setting-select {
  background: rgba(255,255,255,0.05); border: 1px solid var(--border2);
  border-radius: 8px; padding: 8px 12px; color: var(--text1);
  font-size: 13px; font-family: var(--font-body); width: 200px;
  outline: none; -webkit-appearance: none; cursor: pointer;
  transition: border-color 0.2s;
}
.setting-select:focus { border-color: rgba(59,130,246,0.5); }
.color-swatch { width: 28px; height: 28px; border-radius: 8px; border: 2px solid transparent; cursor: pointer; transition: transform 0.15s, border-color 0.15s; }
.color-swatch:hover { transform: scale(1.12); }
.color-swatch.active { border-color: var(--text1); }
.color-row { display: flex; gap: 8px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SEARCH BAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.search-bar {
  display: flex; align-items: center; gap: 10px;
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 10px; padding: 10px 14px;
  margin-bottom: 18px; transition: border-color 0.2s;
}
.search-bar:focus-within { border-color: rgba(59,130,246,0.4); }
.search-bar input {
  background: transparent; border: none; outline: none;
  color: var(--text1); font-size: 14px; font-family: var(--font-body); flex: 1;
}
.search-bar input::placeholder { color: var(--text3); }
.search-icon { color: var(--text3); font-size: 15px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FILTER TABS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.filter-tabs { display: flex; gap: 6px; margin-bottom: 18px; flex-wrap: wrap; }
.filter-tab {
  padding: 6px 14px; border-radius: 8px; font-size: 13px;
  cursor: pointer; border: 1px solid var(--border);
  color: var(--text3); transition: all 0.18s; background: transparent;
  font-family: var(--font-body);
}
.filter-tab:hover { color: var(--text2); background: var(--surface); }
.filter-tab.active { color: var(--brand2); background: rgba(59,130,246,0.12); border-color: rgba(59,130,246,0.3); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.modal-overlay {
  position: fixed; inset: 0;
  background: rgba(0,0,0,0.65); backdrop-filter: blur(8px);
  z-index: 100;
  display: flex; align-items: center; justify-content: center;
  opacity: 0; pointer-events: none; transition: opacity 0.25s;
}
.modal-overlay.open { opacity: 1; pointer-events: all; }
.modal {
  background: #0d1121;
  border: 1px solid rgba(59,130,246,0.25);
  border-radius: 20px; padding: 32px; width: 480px; max-width: 95vw;
  box-shadow: 0 40px 80px rgba(0,0,0,0.6), 0 0 0 1px rgba(255,255,255,0.05);
  transform: scale(0.92) translateY(20px);
  transition: transform 0.3s cubic-bezier(0.22,1,0.36,1);
  max-height: 90vh; overflow-y: auto;
}
.modal-overlay.open .modal { transform: scale(1) translateY(0); }
.modal-title { font-family: var(--font-head); font-size: 20px; font-weight: 800; color: var(--text1); margin-bottom: 24px; }
.form-row { margin-bottom: 16px; }
.form-row label { display: block; font-size: 11px; color: var(--text3); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 6px; }
.form-row input, .form-row select, .form-row textarea {
  width: 100%; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
  border-radius: 10px; padding: 10px 14px; color: var(--text1);
  font-size: 14px; font-family: var(--font-body); outline: none;
  transition: border-color 0.2s; -webkit-appearance: none;
}
.form-row input:focus, .form-row select:focus, .form-row textarea:focus {
  border-color: rgba(59,130,246,0.5); box-shadow: 0 0 0 3px rgba(97, 126, 172, 0.12);
}
.form-row textarea { resize: vertical; min-height: 80px; }
.form-grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.modal-actions { display: flex; gap: 10px; justify-content: flex-end; margin-top: 24px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TRIP STATUS PILLS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.pill { font-size: 11px; padding: 4px 10px; border-radius: 20px; font-weight: 600; display: inline-block; white-space: nowrap; }
.pill-green  { background: rgba(34,197,94,0.12);  color: var(--green);  border: 1px solid rgba(34,197,94,0.25); }
.pill-blue   { background: rgba(59,130,246,0.12); color: var(--brand2); border: 1px solid rgba(59,130,246,0.25); }
.pill-amber  { background: rgba(245,158,11,0.12); color: var(--amber);  border: 1px solid rgba(245,158,11,0.25); }
.pill-red    { background: rgba(239,68,68,0.12);  color: var(--red);    border: 1px solid rgba(239,68,68,0.25); }
.pill-gray   { background: rgba(255,255,255,0.06);color: var(--text3);  border: 1px solid var(--border2); }
.pill-violet { background: rgba(139,92,246,0.12); color: var(--violet); border: 1px solid rgba(139,92,246,0.25); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NOTIFICATION DOT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.notif-dot {
  width: 6px; height: 6px; border-radius: 50%;
  background: var(--red); display: inline-block; margin-left: 6px;
  animation: pulse 2s infinite;
}
@keyframes pulse {
  0%,100% { opacity:1; transform:scale(1); }
  50%      { opacity:0.6; transform:scale(1.3); }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCROLLBAR GLOBAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
::-webkit-scrollbar { width: 5px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: rgba(59,130,246,0.25); border-radius: 4px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EMPTY STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.empty-state { text-align: center; padding: 40px 20px; color: var(--text3); }
.empty-state .emoji { font-size: 40px; margin-bottom: 12px; }
.empty-state p { font-size: 14px; }
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• SIDEBAR â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<aside class="sidebar">
  <div class="logo">â¬¡ <span class="logo-dot">FleetFlow</span></div>

  <div class="nav-section-label">Main</div>
  <div class="nav-item active" data-page="dashboard"><span class="icon">ğŸ </span> Dashboard</div>
  <div class="nav-item" data-page="vehicles"><span class="icon">ğŸš—</span> Vehicles</div>
  <div class="nav-item" data-page="trips"><span class="icon">ğŸ›£ï¸</span> Trips</div>
  <div class="nav-item" data-page="maintenance"><span class="icon">ğŸ”§</span> Maintenance <span class="notif-dot"></span></div>

  <div class="nav-divider"></div>
  <div class="nav-section-label">Finance</div>
  <div class="nav-item" data-page="expenses"><span class="icon">ğŸ’°</span> Expenses</div>
  <div class="nav-item" data-page="analytics"><span class="icon">ğŸ“ˆ</span> Analytics</div>

  <div class="nav-divider"></div>
  <div class="nav-section-label">People</div>
  <div class="nav-item" data-page="drivers"><span class="icon">ğŸ‘¤</span> Drivers</div>
  <div class="nav-item" data-page="safety"><span class="icon">ğŸ›¡ï¸</span> Safety <span class="notif-dot" style="margin-left:4px"></span></div>

  <div class="nav-divider"></div>
  <div class="nav-item" data-page="settings"><span class="icon">âš™ï¸</span> Settings</div>

  <!-- â”€â”€ Profile dropup â”€â”€ -->
  <div class="dropup-wrap">
    <div class="dropup-menu" id="dropupMenu">
      <div class="dropup-head">
        <div class="avatar" id="dropupAvatar">AM</div>
        <div>
          <div class="dropup-name" id="dropupName">Arjun Mehta</div>
          <div class="dropup-email" id="dropupEmail"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="4120252c282f01272d242435272d2e366f282f">[email&#160;protected]</a></div>
        </div>
      </div>
      <div style="padding:4px 0">
        <button class="dropup-item" onclick="navigate('settings');setSettingsTab(document.querySelector('.settings-nav-item'),'profile');openProfilePicModal();closeDropup()">
          <span>ğŸ‘¤</span> Edit Profile / Photo
        </button>
        <button class="dropup-item" onclick="navigate('settings');closeDropup()">
          <span>âš™ï¸</span> Preferences
        </button>
        <button class="dropup-item" onclick="navigate('settings');closeDropup()">
          <span>ğŸ””</span> Notifications
        </button>
        <div class="dropup-sep"></div>
        <button class="dropup-item danger" onclick="doLogout()">
          <span>ğŸšª</span> Sign Out
        </button>
      </div>
    </div>

    <div class="user-card" id="userCard" onclick="toggleDropup(event)">
      <div class="avatar" id="sidebarAvatar">AM</div>
      <div style="min-width:0;flex:1">
        <div class="user-name" id="sidebarName">Arjun Mehta</div>
        <div class="user-role" id="sidebarRole">Fleet Admin</div>
      </div>
      <span class="user-card-arrow" id="dropupArrow">â–²</span>
    </div>
  </div>
</aside>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• MAIN â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<main class="main">

<!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="page active" id="page-dashboard">
  <div class="page-header">
    <div>
      <div class="page-title">Good morning, Admin ğŸ‘‹</div>
      <div class="page-sub" id="todayDate"></div>
    </div>
    <button class="btn btn-primary" onclick="openModal('modal-new-trip')">+ New Trip</button>
  </div>
  <div class="stats-grid">
    <div class="stat-card"><div class="stat-icon">ğŸš—</div><div class="stat-value">24</div><div class="stat-label">Total Vehicles</div><div class="stat-change up">â†‘ 2 this month</div></div>
    <div class="stat-card"><div class="stat-icon">ğŸ›£ï¸</div><div class="stat-value">7</div><div class="stat-label">Active Trips</div><div class="stat-change up">â†‘ 4 from yesterday</div></div>
    <div class="stat-card"><div class="stat-icon">ğŸ”§</div><div class="stat-value">3</div><div class="stat-label">Due Maintenance</div><div class="stat-change down">2 overdue</div></div>
    <div class="stat-card"><div class="stat-icon">ğŸ’°</div><div class="stat-value">â‚¹1.4L</div><div class="stat-label">Monthly Expenses</div><div class="stat-change down">â†‘ 8% vs last month</div></div>
  </div>
  <div class="grid-3">
    <div class="card">
      <div class="card-head"><h3>Weekly Trips</h3><span class="badge badge-brand">118 total</span></div>
      <div class="bar-chart" id="weeklyChart"></div>
    </div>
    <div class="card">
      <div class="card-head"><h3>Recent Activity</h3></div>
      <div class="al-container">
        <div class="al-scroll" id="activityScroll"></div>
        <div class="al-grad-top"></div><div class="al-grad-bot"></div>
      </div>
    </div>
  </div>
  <div class="grid-2">
    <div class="card">
      <div class="card-head"><h3>Active Trips</h3><span class="badge badge-green">â— Live</span></div>
      <div class="al-container">
        <div class="al-scroll" id="tripsScroll"></div>
        <div class="al-grad-top"></div><div class="al-grad-bot"></div>
      </div>
    </div>
    <div class="card">
      <div class="card-head"><h3>Fleet Utilization</h3></div>
      <div id="utilizationList"></div>
    </div>
  </div>
</div>

<!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ VEHICLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="page" id="page-vehicles">
  <div class="page-header">
    <div>
      <div class="page-title">Vehicles</div>
      <div class="page-sub">Manage your entire fleet in one place</div>
    </div>
    <button class="btn btn-primary" onclick="openModal('modal-add-vehicle')">+ Add Vehicle</button>
  </div>
  <div class="stats-grid">
    <div class="stat-card"><div class="stat-icon">ğŸš›</div><div class="stat-value">14</div><div class="stat-label">Trucks</div><div class="stat-change up">â†‘ 1 new</div></div>
    <div class="stat-card"><div class="stat-icon">ğŸš</div><div class="stat-value">6</div><div class="stat-label">Vans</div><div class="stat-change up">Active</div></div>
    <div class="stat-card"><div class="stat-icon">ğŸŸ¢</div><div class="stat-value">20</div><div class="stat-label">Operational</div><div class="stat-change up">83%</div></div>
    <div class="stat-card"><div class="stat-icon">ğŸ”´</div><div class="stat-value">4</div><div class="stat-label">In Service</div><div class="stat-change bad">2 overdue</div></div>
  </div>
  <div class="search-bar"><span class="search-icon">ğŸ”</span><input type="text" placeholder="Search by plate, model, driverâ€¦" id="vehicleSearch" oninput="filterVehicles()"></div>
  <div class="filter-tabs">
    <button class="filter-tab active" onclick="setVehicleFilter(this,'all')">All (24)</button>
    <button class="filter-tab" onclick="setVehicleFilter(this,'active')">Active</button>
    <button class="filter-tab" onclick="setVehicleFilter(this,'service')">In Service</button>
    <button class="filter-tab" onclick="setVehicleFilter(this,'idle')">Idle</button>
  </div>
  <div class="vehicle-grid" id="vehicleGrid"></div>
</div>

<!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ TRIPS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="page" id="page-trips">
  <div class="page-header">
    <div>
      <div class="page-title">Trips</div>
      <div class="page-sub">Track and manage all fleet journeys</div>
    </div>
    <button class="btn btn-primary" onclick="openModal('modal-new-trip')">+ New Trip</button>
  </div>
  <div class="stats-grid">
    <div class="stat-card"><div class="stat-icon">ğŸŸ¢</div><div class="stat-value">7</div><div class="stat-label">Active Now</div><div class="stat-change up">â— Live</div></div>
    <div class="stat-card"><div class="stat-icon">âœ…</div><div class="stat-value">142</div><div class="stat-label">Completed</div><div class="stat-change up">This month</div></div>
    <div class="stat-card"><div class="stat-icon">âš ï¸</div><div class="stat-value">3</div><div class="stat-label">Delayed</div><div class="stat-change bad">Action needed</div></div>
    <div class="stat-card"><div class="stat-icon">ğŸ›£ï¸</div><div class="stat-value">28.4k</div><div class="stat-label">KM This Month</div><div class="stat-change up">â†‘ 12%</div></div>
  </div>
  <div class="grid-3 mb16">
    <div class="card">
      <div class="card-head"><h3>Monthly Trip Volume</h3><span class="badge badge-brand">142 trips</span></div>
      <div class="bar-chart" id="tripMonthChart"></div>
    </div>
    <div class="card">
      <div class="card-head"><h3>Trip Status Breakdown</h3></div>
      <div style="display:flex;align-items:center;gap:24px;padding-top:8px">
        <div class="donut-wrap" style="width:120px;height:120px;flex-shrink:0">
          <svg class="donut-svg" width="120" height="120" viewBox="0 0 120 120">
            <circle cx="60" cy="60" r="46" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="14"/>
            <circle cx="60" cy="60" r="46" fill="none" stroke="#22c55e" stroke-width="14" stroke-dasharray="183 106" stroke-linecap="round"/>
            <circle cx="60" cy="60" r="46" fill="none" stroke="#3b82f6" stroke-width="14" stroke-dasharray="53 236" stroke-dashoffset="-183" stroke-linecap="round"/>
            <circle cx="60" cy="60" r="46" fill="none" stroke="#f59e0b" stroke-width="14" stroke-dasharray="29 260" stroke-dashoffset="-236" stroke-linecap="round"/>
            <circle cx="60" cy="60" r="46" fill="none" stroke="#ef4444" stroke-width="14" stroke-dasharray="24 265" stroke-dashoffset="-265" stroke-linecap="round"/>
          </svg>
          <div class="donut-center"><div class="donut-val">152</div><div class="donut-lbl">Total</div></div>
        </div>
        <ul class="legend-list" style="flex:1">
          <li class="legend-item"><span class="legend-dot" style="background:#22c55e"></span>Completed<span class="legend-pct">142</span></li>
          <li class="legend-item"><span class="legend-dot" style="background:#3b82f6"></span>Active<span class="legend-pct">7</span></li>
          <li class="legend-item"><span class="legend-dot" style="background:#f59e0b"></span>Delayed<span class="legend-pct">3</span></li>
          <li class="legend-item"><span class="legend-dot" style="background:#ef4444"></span>Cancelled<span class="legend-pct">â€”</span></li>
        </ul>
      </div>
    </div>
  </div>
  <div class="card">
    <div class="card-head">
      <h3>All Trips</h3>
      <div style="display:flex;gap:8px">
        <div class="filter-tabs" style="margin:0">
          <button class="filter-tab active" onclick="setTripFilter(this,'all')">All</button>
          <button class="filter-tab" onclick="setTripFilter(this,'active')">Active</button>
          <button class="filter-tab" onclick="setTripFilter(this,'completed')">Completed</button>
          <button class="filter-tab" onclick="setTripFilter(this,'delayed')">Delayed</button>
        </div>
      </div>
    </div>
    <div class="table-wrap"><table>
      <thead><tr>
        <th>Trip ID</th><th>Driver</th><th>Vehicle</th><th>Route</th><th>Distance</th><th>Status</th><th>Date</th><th></th>
      </tr></thead>
      <tbody id="tripsTable"></tbody>
    </table></div>
  </div>
</div>

<!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ MAINTENANCE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="page" id="page-maintenance">
  <div class="page-header">
    <div>
      <div class="page-title">Maintenance</div>
      <div class="page-sub">Keep your fleet in peak condition</div>
    </div>
    <button class="btn btn-primary" onclick="openModal('modal-add-maintenance')">+ Schedule Service</button>
  </div>
  <div class="stats-grid">
    <div class="stat-card"><div class="stat-icon">ğŸ”´</div><div class="stat-value">2</div><div class="stat-label">Overdue</div><div class="stat-change bad">Urgent action</div></div>
    <div class="stat-card"><div class="stat-icon">ğŸŸ¡</div><div class="stat-value">3</div><div class="stat-label">Due Soon</div><div class="stat-change down">Within 7 days</div></div>
    <div class="stat-card"><div class="stat-icon">ğŸŸ¢</div><div class="stat-value">19</div><div class="stat-label">Healthy</div><div class="stat-change up">Good condition</div></div>
    <div class="stat-card"><div class="stat-icon">ğŸ’¸</div><div class="stat-value">â‚¹68K</div><div class="stat-label">Spend This Month</div><div class="stat-change down">â†‘ 14% vs last</div></div>
  </div>
  <div class="grid-2">
    <div class="card">
      <div class="card-head"><h3>Upcoming & Overdue</h3><span class="badge badge-red">2 urgent</span></div>
      <div class="timeline" id="maintenanceTimeline"></div>
    </div>
    <div class="card">
      <div class="card-head"><h3>Service History</h3></div>
      <div class="table-wrap"><table>
        <thead><tr><th>Vehicle</th><th>Service</th><th>Cost</th><th>Date</th><th>Status</th></tr></thead>
        <tbody id="serviceHistoryTable"></tbody>
      </table></div>
    </div>
  </div>
  <div class="card mt16" style="margin-top:16px">
    <div class="card-head"><h3>All Vehicles â€” Health Status</h3></div>
    <div class="table-wrap"><table>
      <thead><tr><th>Vehicle</th><th>Last Service</th><th>Next Due</th><th>Mileage</th><th>Engine</th><th>Tyres</th><th>Status</th></tr></thead>
      <tbody id="vehicleHealthTable"></tbody>
    </table></div>
  </div>
</div>

<!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ EXPENSES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="page" id="page-expenses">
  <div class="page-header">
    <div>
      <div class="page-title">Expenses</div>
      <div class="page-sub">Financial overview across your fleet</div>
    </div>
    <button class="btn btn-primary" onclick="openModal('modal-add-expense')">+ Log Expense</button>
  </div>
  <div class="stats-grid">
    <div class="stat-card"><div class="stat-icon">ğŸ’°</div><div class="stat-value">â‚¹1.4L</div><div class="stat-label">This Month</div><div class="stat-change down">â†‘ 8% vs last</div></div>
    <div class="stat-card"><div class="stat-icon">â›½</div><div class="stat-value">â‚¹68K</div><div class="stat-label">Fuel</div><div class="stat-change up">48% of total</div></div>
    <div class="stat-card"><div class="stat-icon">ğŸ”§</div><div class="stat-value">â‚¹42K</div><div class="stat-label">Maintenance</div><div class="stat-change down">â†‘ 14%</div></div>
    <div class="stat-card"><div class="stat-icon">ğŸ“‹</div><div class="stat-value">â‚¹30K</div><div class="stat-label">Admin & Other</div><div class="stat-change up">â†“ 5%</div></div>
  </div>
  <div class="grid-2 mb16">
    <div class="card">
      <div class="card-head"><h3>Monthly Spend Trend</h3></div>
      <div class="bar-chart" id="expenseChart" style="height:110px"></div>
    </div>
    <div class="card">
      <div class="card-head"><h3>Expense Breakdown</h3></div>
      <div style="display:flex;align-items:center;gap:28px;padding-top:4px">
        <div class="donut-wrap" style="width:130px;height:130px;flex-shrink:0">
          <svg class="donut-svg" width="130" height="130" viewBox="0 0 130 130">
            <circle cx="65" cy="65" r="50" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="14"/>
            <circle cx="65" cy="65" r="50" fill="none" stroke="#3b82f6" stroke-width="14" stroke-dasharray="151 163" stroke-linecap="round"/>
            <circle cx="65" cy="65" r="50" fill="none" stroke="#8b5cf6" stroke-width="14" stroke-dasharray="88 226" stroke-dashoffset="-151" stroke-linecap="round"/>
            <circle cx="65" cy="65" r="50" fill="none" stroke="#22c55e" stroke-width="14" stroke-dasharray="44 270" stroke-dashoffset="-239" stroke-linecap="round"/>
            <circle cx="65" cy="65" r="50" fill="none" stroke="#f59e0b" stroke-width="14" stroke-dasharray="31 283" stroke-dashoffset="-283" stroke-linecap="round"/>
          </svg>
          <div class="donut-center"><div class="donut-val">â‚¹1.4L</div><div class="donut-lbl">Total</div></div>
        </div>
        <ul class="legend-list" style="flex:1">
          <li class="legend-item"><span class="legend-dot" style="background:#3b82f6"></span>Fuel<span class="legend-pct">48%</span></li>
          <li class="legend-item"><span class="legend-dot" style="background:#8b5cf6"></span>Maintenance<span class="legend-pct">30%</span></li>
          <li class="legend-item"><span class="legend-dot" style="background:#22c55e"></span>Insurance<span class="legend-pct">14%</span></li>
          <li class="legend-item"><span class="legend-dot" style="background:#f59e0b"></span>Tolls & Other<span class="legend-pct">8%</span></li>
        </ul>
      </div>
    </div>
  </div>
  <div class="card">
    <div class="card-head"><h3>Recent Transactions</h3>
      <div class="filter-tabs" style="margin:0">
        <button class="filter-tab active" onclick="setExpFilter(this,'all')">All</button>
        <button class="filter-tab" onclick="setExpFilter(this,'fuel')">Fuel</button>
        <button class="filter-tab" onclick="setExpFilter(this,'maintenance')">Maintenance</button>
        <button class="filter-tab" onclick="setExpFilter(this,'other')">Other</button>
      </div>
    </div>
    <div class="table-wrap"><table>
      <thead><tr><th>Date</th><th>Vehicle</th><th>Category</th><th>Description</th><th>Amount</th><th>Added By</th></tr></thead>
      <tbody id="expensesTable"></tbody>
    </table></div>
  </div>
</div>

<!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ DRIVERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="page" id="page-drivers">
  <div class="page-header">
    <div>
      <div class="page-title">Drivers</div>
      <div class="page-sub">Your fleet's people â€” managed well</div>
    </div>
    <button class="btn btn-primary" onclick="openModal('modal-add-driver')">+ Add Driver</button>
  </div>
  <div class="stats-grid">
    <div class="stat-card"><div class="stat-icon">ğŸ‘¥</div><div class="stat-value">18</div><div class="stat-label">Total Drivers</div><div class="stat-change up">â†‘ 2 this month</div></div>
    <div class="stat-card"><div class="stat-icon">ğŸŸ¢</div><div class="stat-value">12</div><div class="stat-label">On Duty</div><div class="stat-change up">Active now</div></div>
    <div class="stat-card"><div class="stat-icon">â­</div><div class="stat-value">4.7</div><div class="stat-label">Avg. Rating</div><div class="stat-change up">â†‘ 0.2</div></div>
    <div class="stat-card"><div class="stat-icon">ğŸ“‹</div><div class="stat-value">3</div><div class="stat-label">License Expiring</div><div class="stat-change bad">Within 30 days</div></div>
  </div>
  <div class="search-bar"><span class="search-icon">ğŸ”</span><input type="text" placeholder="Search drivers by name, ID, routeâ€¦"></div>
  <div class="filter-tabs">
    <button class="filter-tab active" onclick="setDriverFilter(this,'all')">All Drivers</button>
    <button class="filter-tab" onclick="setDriverFilter(this,'active')">On Duty</button>
    <button class="filter-tab" onclick="setDriverFilter(this,'off')">Off Duty</button>
    <button class="filter-tab" onclick="setDriverFilter(this,'top')">Top Rated</button>
  </div>
  <div class="driver-grid" id="driverGrid"></div>
</div>

<!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SETTINGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="page" id="page-settings">
  <div class="page-header">
    <div>
      <div class="page-title">Settings</div>
      <div class="page-sub">Customize FleetFlow to your needs</div>
    </div>
    <button class="btn btn-primary" onclick="saveSettings()">Save Changes</button>
  </div>
  <div class="settings-layout">
    <nav class="settings-nav">
      <div class="settings-nav-item active" onclick="setSettingsTab(this,'profile')">ğŸ‘¤ Profile</div>
      <div class="settings-nav-item" onclick="setSettingsTab(this,'company')">ğŸ¢ Company</div>
      <div class="settings-nav-item" onclick="setSettingsTab(this,'notifications')">ğŸ”” Notifications</div>
      <div class="settings-nav-item" onclick="setSettingsTab(this,'appearance')">ğŸ¨ Appearance</div>
      <div class="settings-nav-item" onclick="setSettingsTab(this,'security')">ğŸ”’ Security</div>
      <div class="settings-nav-item" onclick="setSettingsTab(this,'integrations')">ğŸ”— Integrations</div>
    </nav>
    <div>
      <!-- Profile -->
      <div class="settings-section active" id="settings-profile">
        <div class="settings-group">
          <div class="settings-group-title">Personal Information</div>
          <div style="display:flex;align-items:center;gap:20px;margin-bottom:20px;padding:16px;background:var(--surface);border-radius:12px;border:1px solid var(--border)">
            <div class="avatar" style="width:56px;height:56px;font-size:20px">AM</div>
            <div><div id="settingsDisplayName" style="font-size:14px;font-weight:600;color:var(--text1);margin-bottom:4px">â€”</div><div id="settingsRoleLabel" style="font-size:12px;color:var(--text3)">Fleet Administrator</div></div>
            <button class="btn btn-ghost btn-sm" style="margin-left:auto" onclick="openProfilePicModal()">Change Photo</button>
          </div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">Full Name</div><div class="setting-desc">Your display name across the platform</div></div><input class="setting-input" id="settingsName" placeholder="Your name"></div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">Email Address</div><div class="setting-desc">Used for notifications and login</div></div><input class="setting-input" id="settingsEmail" type="email" placeholder="your@email.com"></div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">Phone Number</div><div class="setting-desc">For SMS alerts and 2FA</div></div><input class="setting-input" id="settingsPhone" placeholder="+91 XXXXX XXXXX"></div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">Role</div></div><select class="setting-select" id="settingsRole"><option>Fleet Administrator</option><option>Manager</option><option>Dispatcher</option><option>Viewer</option></select></div>
        </div>
      </div>
      <!-- Company -->
      <div class="settings-section" id="settings-company">
        <div class="settings-group">
          <div class="settings-group-title">Company Details</div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">Company Name</div></div><input class="setting-input" value="Mehta Logistics Pvt Ltd"></div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">GST Number</div></div><input class="setting-input" value="27AAAAA0000A1Z5"></div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">State</div></div><select class="setting-select"><option>Maharashtra</option><option>Gujarat</option><option>Karnataka</option></select></div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">Currency</div></div><select class="setting-select"><option>INR (â‚¹)</option><option>USD ($)</option></select></div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">Fiscal Year Start</div></div><select class="setting-select"><option>April</option><option>January</option></select></div>
        </div>
      </div>
      <!-- Notifications -->
      <div class="settings-section" id="settings-notifications">
        <div class="settings-group">
          <div class="settings-group-title">Alert Preferences</div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">Trip Started / Completed</div><div class="setting-desc">Notify when a trip begins or ends</div></div><label class="toggle"><input type="checkbox" checked><span class="toggle-slider"></span></label></div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">Maintenance Due</div><div class="setting-desc">Alerts 7 days before service deadline</div></div><label class="toggle"><input type="checkbox" checked><span class="toggle-slider"></span></label></div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">Fuel Low Warning</div><div class="setting-desc">Alert when fuel drops below 20%</div></div><label class="toggle"><input type="checkbox" checked><span class="toggle-slider"></span></label></div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">Trip Delays</div><div class="setting-desc">Notify on delay beyond threshold</div></div><label class="toggle"><input type="checkbox" checked><span class="toggle-slider"></span></label></div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">License Expiry Reminders</div><div class="setting-desc">30-day advance notice for drivers</div></div><label class="toggle"><input type="checkbox"><span class="toggle-slider"></span></label></div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">Daily Summary Email</div><div class="setting-desc">End-of-day fleet summary to inbox</div></div><label class="toggle"><input type="checkbox" checked><span class="toggle-slider"></span></label></div>
        </div>
        <div class="settings-group">
          <div class="settings-group-title">Delivery Methods</div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">Email Notifications</div></div><label class="toggle"><input type="checkbox" checked><span class="toggle-slider"></span></label></div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">SMS Alerts</div></div><label class="toggle"><input type="checkbox" checked><span class="toggle-slider"></span></label></div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">Push Notifications</div></div><label class="toggle"><input type="checkbox"><span class="toggle-slider"></span></label></div>
        </div>
      </div>
      <!-- Appearance -->
      <div class="settings-section" id="settings-appearance">
        <div class="settings-group">
          <div class="settings-group-title">Theme</div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">Color Mode</div><div class="setting-desc">Interface brightness preference</div></div><select class="setting-select"><option>Dark</option><option>Light</option><option>System</option></select></div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">Accent Color</div><div class="setting-desc">Primary brand color used across UI</div></div>
            <div class="color-row">
              <div class="color-swatch active" style="background:#3b82f6"></div>
              <div class="color-swatch" style="background:#8b5cf6"></div>
              <div class="color-swatch" style="background:#22c55e"></div>
              <div class="color-swatch" style="background:#f59e0b"></div>
              <div class="color-swatch" style="background:#ec4899"></div>
              <div class="color-swatch" style="background:#06b6d4"></div>
            </div>
          </div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">Sidebar Style</div></div><select class="setting-select"><option>Compact</option><option>Expanded</option></select></div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">Table Density</div></div><select class="setting-select"><option>Comfortable</option><option>Compact</option><option>Spacious</option></select></div>
        </div>
        <div class="settings-group">
          <div class="settings-group-title">Regional</div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">Date Format</div></div><select class="setting-select"><option>DD/MM/YYYY</option><option>MM/DD/YYYY</option><option>YYYY-MM-DD</option></select></div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">Distance Unit</div></div><select class="setting-select"><option>Kilometers (km)</option><option>Miles (mi)</option></select></div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">Time Format</div></div><select class="setting-select"><option>24-hour</option><option>12-hour (AM/PM)</option></select></div>
        </div>
      </div>
      <!-- Security -->
      <div class="settings-section" id="settings-security">
        <div class="settings-group">
          <div class="settings-group-title">Password</div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">Current Password</div></div><input class="setting-input" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"></div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">New Password</div></div><input class="setting-input" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"></div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">Confirm New Password</div></div><input class="setting-input" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"></div>
        </div>
        <div class="settings-group">
          <div class="settings-group-title">Two-Factor Authentication</div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">Enable 2FA</div><div class="setting-desc">Secure your account with OTP on login</div></div><label class="toggle"><input type="checkbox"><span class="toggle-slider"></span></label></div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">Login Alerts</div><div class="setting-desc">Get notified on new device logins</div></div><label class="toggle"><input type="checkbox" checked><span class="toggle-slider"></span></label></div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">Session Timeout</div></div><select class="setting-select"><option>30 minutes</option><option>1 hour</option><option>8 hours</option><option>Never</option></select></div>
        </div>
        <div class="settings-group">
          <div class="settings-group-title">Danger Zone</div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">Export All Data</div><div class="setting-desc">Download full backup as CSV/JSON</div></div><button class="btn btn-ghost btn-sm">Export</button></div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">Delete Account</div><div class="setting-desc">Permanently remove all data</div></div><button class="btn btn-danger btn-sm">Delete</button></div>
        </div>
      </div>
      <!-- Integrations -->
      <div class="settings-section" id="settings-integrations">
        <div class="settings-group">
          <div class="settings-group-title">Connected Services</div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">Google Maps API</div><div class="setting-desc">Route planning and live tracking</div></div><span class="badge badge-green">Connected</span></div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">Tally / ERP</div><div class="setting-desc">Auto-sync expense data</div></div><button class="btn btn-ghost btn-sm">Connect</button></div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">WhatsApp Business</div><div class="setting-desc">Send alerts via WhatsApp</div></div><span class="badge badge-green">Connected</span></div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">FASTag Integration</div><div class="setting-desc">Auto-log toll expenses</div></div><button class="btn btn-ghost btn-sm">Connect</button></div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">Slack Notifications</div><div class="setting-desc">Push alerts to Slack channels</div></div><button class="btn btn-ghost btn-sm">Connect</button></div>
        </div>
        <div class="settings-group">
          <div class="settings-group-title">API Access</div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">API Key</div><div class="setting-desc">Use for custom integrations</div></div><input class="setting-input" value="ff_live_â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" readonly></div>
          <div class="setting-row"><div class="setting-info"><div class="setting-label">Webhook URL</div><div class="setting-desc">Receive real-time event callbacks</div></div><input class="setting-input" placeholder="https://your-server.com/webhook"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ANALYTICS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="page" id="page-analytics">
  <div class="page-header">
    <div>
      <div class="page-title">Analytics & Reports</div>
      <div class="page-sub">Data-driven decisions for your fleet</div>
    </div>
    <div style="display:flex;gap:10px">
      <button class="btn btn-ghost btn-sm" onclick="exportCSV()">â¬‡ï¸ Export CSV</button>
      <button class="btn btn-ghost btn-sm" onclick="exportPDF()">ğŸ“„ Export PDF</button>
    </div>
  </div>
  <div class="stats-grid">
    <div class="stat-card"><div class="stat-icon">â›½</div><div class="stat-value">6.2</div><div class="stat-label">Fuel Efficiency (km/L)</div><div class="stat-change up">â†‘ 0.4 vs last month</div></div>
    <div class="stat-card"><div class="stat-icon">ğŸ“Š</div><div class="stat-value">18.4%</div><div class="stat-label">Avg Vehicle ROI</div><div class="stat-change up">â†‘ 3.2%</div></div>
    <div class="stat-card"><div class="stat-icon">ğŸ’¸</div><div class="stat-value">â‚¹4.8/km</div><div class="stat-label">Cost per KM</div><div class="stat-change down">â†‘ â‚¹0.3</div></div>
    <div class="stat-card"><div class="stat-icon">ğŸš›</div><div class="stat-value">74%</div><div class="stat-label">Fleet Utilization</div><div class="stat-change up">â†‘ 6%</div></div>
  </div>
  <div class="grid-2 mb16">
    <div class="card">
      <div class="card-head"><h3>Revenue vs Costs (6 months)</h3><span class="badge badge-green">Profitable</span></div>
      <div class="bar-chart" id="revenueChart" style="height:110px"></div>
    </div>
    <div class="card">
      <div class="card-head"><h3>Cost Breakdown</h3></div>
      <div style="display:flex;align-items:center;gap:24px;padding-top:8px">
        <div class="donut-wrap" style="width:120px;height:120px;flex-shrink:0">
          <svg class="donut-svg" width="120" height="120" viewBox="0 0 120 120">
            <circle cx="60" cy="60" r="46" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="14"/>
            <circle cx="60" cy="60" r="46" fill="none" stroke="#3b82f6" stroke-width="14" stroke-dasharray="145 144" stroke-linecap="round"/>
            <circle cx="60" cy="60" r="46" fill="none" stroke="#8b5cf6" stroke-width="14" stroke-dasharray="86 203" stroke-dashoffset="-145" stroke-linecap="round"/>
            <circle cx="60" cy="60" r="46" fill="none" stroke="#f59e0b" stroke-width="14" stroke-dasharray="58 231" stroke-dashoffset="-231" stroke-linecap="round"/>
          </svg>
          <div class="donut-center"><div class="donut-val">â‚¹1.4L</div><div class="donut-lbl">Total</div></div>
        </div>
        <ul class="legend-list" style="flex:1">
          <li class="legend-item"><span class="legend-dot" style="background:#3b82f6"></span>Fuel<span class="legend-pct">48%</span></li>
          <li class="legend-item"><span class="legend-dot" style="background:#8b5cf6"></span>Maintenance<span class="legend-pct">30%</span></li>
          <li class="legend-item"><span class="legend-dot" style="background:#f59e0b"></span>Admin & Other<span class="legend-pct">22%</span></li>
        </ul>
      </div>
    </div>
  </div>
  <div class="card mb16" style="margin-bottom:16px">
    <div class="card-head"><h3>Vehicle ROI Report</h3><span class="badge badge-brand">Revenue âˆ’ (Maint + Fuel) / Acquisition</span></div>
    <div class="table-wrap"><table>
      <thead><tr><th>Vehicle</th><th>Type</th><th>Revenue (â‚¹)</th><th>Fuel Cost (â‚¹)</th><th>Maint Cost (â‚¹)</th><th>Acquisition (â‚¹)</th><th>ROI %</th><th>Fuel Eff.</th></tr></thead>
      <tbody id="roiTable"></tbody>
    </table></div>
  </div>
  <div class="card">
    <div class="card-head"><h3>Monthly P&L Summary</h3></div>
    <div class="table-wrap"><table>
      <thead><tr><th>Month</th><th>Trips</th><th>Revenue (â‚¹)</th><th>Total Costs (â‚¹)</th><th>Net Profit (â‚¹)</th><th>Margin %</th></tr></thead>
      <tbody id="plTable"></tbody>
    </table></div>
  </div>
</div>

<!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SAFETY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="page" id="page-safety">
  <div class="page-header">
    <div>
      <div class="page-title">Safety & Compliance</div>
      <div class="page-sub">Driver safety scores, license status & incident management</div>
    </div>
    <button class="btn btn-primary" onclick="openModal('modal-log-incident')">+ Log Incident</button>
  </div>
  <div class="stats-grid">
    <div class="stat-card"><div class="stat-icon">ğŸ›¡ï¸</div><div class="stat-value">4.6</div><div class="stat-label">Fleet Safety Score</div><div class="stat-change up">â†‘ 0.2 this month</div></div>
    <div class="stat-card"><div class="stat-icon">âš ï¸</div><div class="stat-value">3</div><div class="stat-label">License Expiring</div><div class="stat-change bad">Within 30 days</div></div>
    <div class="stat-card"><div class="stat-icon">ğŸš«</div><div class="stat-value">1</div><div class="stat-label">Suspended Drivers</div><div class="stat-change bad">Action required</div></div>
    <div class="stat-card"><div class="stat-icon">ğŸ“‹</div><div class="stat-value">2</div><div class="stat-label">Open Incidents</div><div class="stat-change down">Under review</div></div>
  </div>
  <div class="grid-2 mb16">
    <div class="card">
      <div class="card-head"><h3>License Expiry Tracker</h3><span class="badge badge-red">3 expiring soon</span></div>
      <div class="table-wrap"><table>
        <thead><tr><th>Driver</th><th>License No.</th><th>Category</th><th>Expiry</th><th>Status</th><th>Action</th></tr></thead>
        <tbody id="licenseTable"></tbody>
      </table></div>
    </div>
    <div class="card">
      <div class="card-head"><h3>Safety Scores</h3></div>
      <div id="safetyScoreList"></div>
    </div>
  </div>
  <div class="card">
    <div class="card-head"><h3>Incident Log</h3></div>
    <div class="table-wrap"><table>
      <thead><tr><th>Date</th><th>Driver</th><th>Vehicle</th><th>Type</th><th>Severity</th><th>Status</th></tr></thead>
      <tbody id="incidentTable"></tbody>
    </table></div>
  </div>
</div>

</main>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MODALS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="modal-new-trip" onclick="if(event.target===this)closeModal('modal-new-trip')">
  <div class="modal">
    <div class="modal-title">ğŸ—ºï¸ New Trip</div>
    <div class="form-grid-2">
      <div class="form-row"><label>Driver</label><select id="nt-driver"><option value="">Select driverâ€¦</option><option>Arjun Mehta</option><option>Priya Shah</option><option>Rohan Das</option><option>Sneha Patel</option><option>Vikram Singh</option></select></div>
      <div class="form-row"><label>Vehicle</label><select id="nt-vehicle"><option value="">Select vehicleâ€¦</option><option>MH-01-AB-1234</option><option>MH-02-CD-5678</option><option>GJ-05-EF-9012</option><option>MH-04-GH-3456</option><option>RJ-14-XY-0099</option></select></div>
    </div>
    <div class="form-grid-2">
      <div class="form-row"><label>Origin</label><input type="text" id="nt-origin" placeholder="Pickup location"></div>
      <div class="form-row"><label>Destination</label><input type="text" id="nt-dest" placeholder="Drop location"></div>
    </div>
    <div class="form-grid-2">
      <div class="form-row"><label>Departure</label><input type="datetime-local" id="nt-depart"></div>
      <div class="form-row"><label>Est. Distance (km)</label><input type="number" id="nt-dist" placeholder="0"></div>
    </div>
    <div class="form-row"><label>Notes</label><textarea id="nt-notes" placeholder="Any special instructionsâ€¦"></textarea></div>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="closeModal('modal-new-trip')">Cancel</button>
      <button class="btn btn-primary" onclick="submitTrip()">Create Trip</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="modal-add-vehicle" onclick="if(event.target===this)closeModal('modal-add-vehicle')">
  <div class="modal">
    <div class="modal-title">ğŸš— Add Vehicle</div>
    <div class="form-grid-2">
      <div class="form-row"><label>Registration Number</label><input type="text" id="av-reg" placeholder="MH-01-AB-1234"></div>
      <div class="form-row"><label>Vehicle Type</label><select id="av-type"><option>Truck</option><option>Van</option><option>SUV</option><option>Pickup</option></select></div>
    </div>
    <div class="form-grid-2">
      <div class="form-row"><label>Make</label><input type="text" id="av-make" placeholder="Tata, Ashok Leylandâ€¦"></div>
      <div class="form-row"><label>Model</label><input type="text" id="av-model" placeholder="Prima, Dostâ€¦"></div>
    </div>
    <div class="form-grid-2">
      <div class="form-row"><label>Year</label><input type="number" id="av-year" placeholder="2022"></div>
      <div class="form-row"><label>Fuel Type</label><select id="av-fuel"><option>Diesel</option><option>Petrol</option><option>CNG</option><option>Electric</option></select></div>
    </div>
    <div class="form-grid-2">
      <div class="form-row"><label>Assign Driver</label><select id="av-driver"><option value="">Unassigned</option><option>Arjun Mehta</option><option>Priya Shah</option><option>Rohan Das</option></select></div>
      <div class="form-row"><label>Current Mileage (km)</label><input type="number" id="av-km" placeholder="0"></div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="closeModal('modal-add-vehicle')">Cancel</button>
      <button class="btn btn-primary" onclick="submitVehicle()">Add Vehicle</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="modal-add-maintenance" onclick="if(event.target===this)closeModal('modal-add-maintenance')">
  <div class="modal">
    <div class="modal-title">ğŸ”§ Schedule Service</div>
    <div class="form-row"><label>Vehicle</label><select id="am-vehicle"><option value="">Select vehicleâ€¦</option><option>MH-01-AB-1234</option><option>MH-02-CD-5678</option><option>GJ-05-EF-9012</option><option>MH-04-GH-3456</option><option>RJ-14-XY-0099</option><option>KA-09-XY-2233</option></select></div>
    <div class="form-grid-2">
      <div class="form-row"><label>Service Type</label><select id="am-type"><option>Oil Change</option><option>Tyre Rotation</option><option>Brake Service</option><option>Engine Tune-up</option><option>Full Service</option><option>AC Service</option></select></div>
      <div class="form-row"><label>Scheduled Date</label><input type="date" id="am-date"></div>
    </div>
    <div class="form-grid-2">
      <div class="form-row"><label>Service Center</label><input id="am-center" placeholder="Vendor / garage name"></div>
      <div class="form-row"><label>Estimated Cost (â‚¹)</label><input type="number" id="am-cost" placeholder="0"></div>
    </div>
    <div class="form-row"><label>Notes</label><textarea id="am-notes" placeholder="Details about the serviceâ€¦"></textarea></div>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="closeModal('modal-add-maintenance')">Cancel</button>
      <button class="btn btn-primary" onclick="submitMaintenance()">Schedule Service</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="modal-add-expense" onclick="if(event.target===this)closeModal('modal-add-expense')">
  <div class="modal">
    <div class="modal-title">ğŸ’° Log Expense</div>
    <div class="form-grid-2">
      <div class="form-row"><label>Vehicle</label><select id="ae-vehicle"><option value="">Select vehicleâ€¦</option><option>MH-01-AB-1234</option><option>MH-02-CD-5678</option><option>GJ-05-EF-9012</option><option>MH-04-GH-3456</option><option>RJ-14-XY-0099</option></select></div>
      <div class="form-row"><label>Category</label><select id="ae-cat"><option value="fuel">Fuel</option><option value="maintenance">Maintenance</option><option value="other">Toll</option><option value="other">Insurance</option><option value="other">Other</option></select></div>
    </div>
    <div class="form-grid-2">
      <div class="form-row"><label>Amount (â‚¹)</label><input type="number" id="ae-amount" placeholder="0"></div>
      <div class="form-row"><label>Date</label><input type="date" id="ae-date"></div>
    </div>
    <div class="form-row"><label>Description</label><input id="ae-desc" placeholder="Brief descriptionâ€¦"></div>
    <div class="form-row"><label>Receipt / Notes</label><textarea id="ae-notes" placeholder="Upload reference or add notesâ€¦"></textarea></div>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="closeModal('modal-add-expense')">Cancel</button>
      <button class="btn btn-primary" onclick="submitExpense()">Log Expense</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="modal-add-driver" onclick="if(event.target===this)closeModal('modal-add-driver')">
  <div class="modal">
    <div class="modal-title">ğŸ‘¤ Add Driver</div>
    <div class="form-grid-2">
      <div class="form-row"><label>Full Name</label><input id="ad-name" placeholder="Driver's full name"></div>
      <div class="form-row"><label>Phone Number</label><input type="tel" id="ad-phone" placeholder="+91 XXXXX XXXXX"></div>
    </div>
    <div class="form-grid-2">
      <div class="form-row"><label>License Number</label><input id="ad-license" placeholder="DL-XXXX-XXXXXXXX"></div>
      <div class="form-row"><label>License Expiry</label><input type="date" id="ad-expiry"></div>
    </div>
    <div class="form-grid-2">
      <div class="form-row"><label>Experience (years)</label><input type="number" id="ad-exp" placeholder="0"></div>
      <div class="form-row"><label>Assign Vehicle</label><select id="ad-vehicle"><option value="">Unassigned</option><option>MH-01-AB-1234</option><option>MH-02-CD-5678</option><option>MH-04-GH-3456</option><option>RJ-14-XY-0099</option></select></div>
    </div>
    <div class="form-row"><label>Home Address</label><input id="ad-addr" placeholder="City, State"></div>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="closeModal('modal-add-driver')">Cancel</button>
      <button class="btn btn-primary" onclick="submitDriver()">Add Driver</button>
    </div>
  </div>
</div>

<!-- Incident Modal -->
<div class="modal-overlay" id="modal-log-incident" onclick="if(event.target===this)closeModal('modal-log-incident')">
  <div class="modal">
    <div class="modal-title">âš ï¸ Log Safety Incident</div>
    <div class="form-grid-2">
      <div class="form-row"><label>Driver</label><select id="inc-driver"><option value="">Select driverâ€¦</option><option>Arjun Mehta</option><option>Priya Shah</option><option>Rohan Das</option><option>Sneha Patel</option><option>Vikram Singh</option></select></div>
      <div class="form-row"><label>Vehicle</label><select id="inc-vehicle"><option value="">Select vehicleâ€¦</option><option>MH-01-AB-1234</option><option>MH-02-CD-5678</option><option>GJ-05-EF-9012</option><option>MH-04-GH-3456</option></select></div>
    </div>
    <div class="form-grid-2">
      <div class="form-row"><label>Incident Type</label><select id="inc-type"><option>Minor Collision</option><option>Traffic Violation</option><option>Speeding</option><option>Route Deviation</option><option>Vehicle Breakdown</option><option>Near Miss</option></select></div>
      <div class="form-row"><label>Severity</label><select id="inc-severity"><option value="low">Low</option><option value="medium">Medium</option><option value="high">High</option></select></div>
    </div>
    <div class="form-grid-2">
      <div class="form-row"><label>Date</label><input type="date" id="inc-date"></div>
      <div class="form-row"><label>Location</label><input id="inc-location" placeholder="City / Highway"></div>
    </div>
    <div class="form-row"><label>Description</label><textarea id="inc-desc" placeholder="Describe what happenedâ€¦"></textarea></div>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="closeModal('modal-log-incident')">Cancel</button>
      <button class="btn btn-danger" onclick="submitIncident()">Log Incident</button>
    </div>
  </div>
</div>

<!-- Profile Picture Modal -->
<div class="modal-overlay" id="modal-profile-pic" onclick="if(event.target===this)closeModal('modal-profile-pic')">
  <div class="modal" style="width:480px">
    <div class="modal-title">ğŸ–¼ï¸ Change Profile Picture</div>

    <!-- Preview -->
    <div style="display:flex;align-items:center;gap:20px;margin-bottom:24px">
      <div id="picPreviewWrap" style="width:80px;height:80px;border-radius:50%;background:linear-gradient(135deg,#3b82f6,#8b5cf6);display:flex;align-items:center;justify-content:center;font-size:28px;font-weight:700;color:#fff;border:3px solid rgba(59,130,246,0.4);overflow:hidden;flex-shrink:0">
        <span id="picPreviewInitials">AM</span>
        <img id="picPreviewImg" style="width:100%;height:100%;object-fit:cover;display:none">
      </div>
      <div style="flex:1">
        <div style="font-size:13px;color:var(--text1);font-weight:600;margin-bottom:4px" id="picPreviewName">Your Name</div>
        <div style="font-size:11px;color:var(--text3)">Choose a photo, sticker, or paste a URL below</div>
      </div>
    </div>

    <!-- Tabs -->
    <div style="display:flex;gap:6px;margin-bottom:18px;border-bottom:1px solid var(--border);padding-bottom:12px" id="picTabs">
      <button class="filter-tab active" onclick="setPicTab(this,'upload')" style="font-size:12px">ğŸ“ Upload</button>
      <button class="filter-tab" onclick="setPicTab(this,'url')" style="font-size:12px">ğŸ”— Paste URL</button>
      <button class="filter-tab" onclick="setPicTab(this,'stickers')" style="font-size:12px">ğŸ˜ Stickers</button>
      <button class="filter-tab" onclick="setPicTab(this,'gradient')" style="font-size:12px">ğŸ¨ Gradient</button>
    </div>

    <!-- Tab: Upload -->
    <div id="picTab-upload" class="pic-tab-panel">
      <label style="display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;padding:28px;border-radius:12px;border:2px dashed rgba(255,255,255,0.15);cursor:pointer;color:var(--text2);font-size:13px;transition:all 0.2s;background:rgba(255,255,255,0.02)" id="uploadLabel"
        onmouseenter="this.style.borderColor='rgba(59,130,246,0.4)'" onmouseleave="this.style.borderColor='rgba(255,255,255,0.15)'">
        <span style="font-size:36px">ğŸ“¸</span>
        <span style="font-weight:600">Click to upload from Gallery or Camera</span>
        <span style="font-size:11px;color:var(--text3)">PNG, JPG, WEBP supported</span>
        <input type="file" id="picFileInput" accept="image/*" style="display:none" onchange="handlePicUpload(this)">
      </label>
    </div>

    <!-- Tab: URL (Pinterest-friendly) -->
    <div id="picTab-url" class="pic-tab-panel" style="display:none">
      <div style="font-size:12px;color:var(--text3);margin-bottom:10px">Paste any image URL â€” from Pinterest, Unsplash, or anywhere:</div>
      <div style="display:flex;gap:8px">
        <input id="picUrlInput" type="url" placeholder="https://i.pinimg.com/..." 
          style="flex:1;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:10px;padding:10px 14px;color:var(--text1);font-size:13px;font-family:var(--font-body);outline:none"
          oninput="previewUrlPic(this.value)">
        <button class="btn btn-primary btn-sm" onclick="previewUrlPic(document.getElementById('picUrlInput').value)">Preview</button>
      </div>
      <div id="urlPreviewThumb" style="display:none;margin-top:14px;text-align:center">
        <img id="urlThumbImg" style="width:80px;height:80px;border-radius:50%;object-fit:cover;border:2px solid rgba(59,130,246,0.4)">
        <div style="font-size:11px;color:var(--text3);margin-top:6px">Looking good! Hit Save to apply.</div>
      </div>
      <div style="margin-top:14px;padding:12px;border-radius:10px;background:rgba(59,130,246,0.07);border:1px solid rgba(59,130,246,0.15)">
        <div style="font-size:11px;color:#60a5fa;font-weight:600;margin-bottom:4px">ğŸ’¡ Pinterest Tip</div>
        <div style="font-size:11px;color:var(--text3)">On Pinterest, right-click any icon â†’ "Open image in new tab" â†’ copy that URL and paste it here.</div>
      </div>
    </div>

    <!-- Tab: Stickers -->
    <div id="picTab-stickers" class="pic-tab-panel" style="display:none">
      <div id="stickerGrid" style="display:grid;grid-template-columns:repeat(8,1fr);gap:8px"></div>
    </div>

    <!-- Tab: Gradient -->
    <div id="picTab-gradient" class="pic-tab-panel" style="display:none">
      <div style="font-size:11px;color:var(--text3);text-transform:uppercase;letter-spacing:1px;margin-bottom:12px">Pick a gradient color for your initials avatar</div>
      <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:10px" id="gradientPicker"></div>
    </div>

    <div class="modal-actions" style="margin-top:24px">
      <button class="btn btn-ghost" onclick="closeModal('modal-profile-pic')">Cancel</button>
      <button class="btn btn-primary" onclick="saveProfilePic()">Save Picture</button>
    </div>
  </div>
</div>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DATA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const WEEKLY = [
  {day:'Mon',val:14},{day:'Tue',val:21},{day:'Wed',val:18},
  {day:'Thu',val:27},{day:'Fri',val:23},{day:'Sat',val:9},{day:'Sun',val:6}
];
const MONTHLY_TRIPS = [
  {day:'Aug',val:98},{day:'Sep',val:112},{day:'Oct',val:134},
  {day:'Nov',val:118},{day:'Dec',val:127},{day:'Jan',val:142}
];
const EXPENSE_MONTHS = [
  {day:'Aug',val:95},{day:'Sep',val:108},{day:'Oct',val:122},
  {day:'Nov',val:115},{day:'Dec',val:131},{day:'Jan',val:140}
];

const ACTIVITY = [
  {icon:'ğŸš—',text:'MH-01-AB-1234 departed Mumbai depot',time:'2m ago',color:'#3b82f6'},
  {icon:'âœ…',text:'Trip #4821 completed by Priya Shah',time:'18m ago',color:'#22c55e'},
  {icon:'âš ï¸',text:'Maintenance due: GJ-05-EF-9012',time:'1h ago',color:'#f59e0b'},
  {icon:'â›½',text:'Fuel log added â€” â‚¹3,200 at Pune stop',time:'2h ago',color:'#8b5cf6'},
  {icon:'ğŸ“',text:'Rohan Das checked in at Surat depot',time:'3h ago',color:'#06b6d4'},
  {icon:'ğŸ”§',text:'Oil change scheduled: MH-02-CD-5678',time:'5h ago',color:'#ec4899'},
  {icon:'ğŸš—',text:'New vehicle added: RJ-14-XY-0099',time:'Yesterday',color:'#3b82f6'},
];

const TRIPS_DATA = [
  {id:'#4826',driver:'Arjun Mehta',vehicle:'MH-01-AB-1234',route:'Mumbai â†’ Pune',dist:'148 km',status:'active',date:'Today'},
  {id:'#4825',driver:'Priya Shah',vehicle:'MH-02-CD-5678',route:'Surat â†’ Vadodara',dist:'142 km',status:'active',date:'Today'},
  {id:'#4824',driver:'Rohan Das',vehicle:'GJ-05-EF-9012',route:'Ahmedabad â†’ Rajkot',dist:'216 km',status:'delayed',date:'Today'},
  {id:'#4823',driver:'Sneha Patel',vehicle:'MH-04-GH-3456',route:'Nashik â†’ Aurangabad',dist:'230 km',status:'active',date:'Today'},
  {id:'#4822',driver:'Vikram Singh',vehicle:'RJ-14-XY-0099',route:'Jaipur â†’ Ajmer',dist:'132 km',status:'completed',date:'20 Feb'},
  {id:'#4821',driver:'Priya Shah',vehicle:'MH-02-CD-5678',route:'Mumbai â†’ Surat',dist:'284 km',status:'completed',date:'20 Feb'},
  {id:'#4820',driver:'Arjun Mehta',vehicle:'MH-01-AB-1234',route:'Pune â†’ Kolhapur',dist:'230 km',status:'completed',date:'19 Feb'},
  {id:'#4819',driver:'Kiran Bhat',vehicle:'KA-09-XY-2233',route:'Bengaluru â†’ Mysuru',dist:'143 km',status:'completed',date:'19 Feb'},
];

const ACTIVE_TRIPS_DASH = [
  {driver:'Arjun Mehta',vehicle:'MH-01-AB-1234',route:'Mumbai â†’ Pune',status:'on-route',eta:'14:30'},
  {driver:'Priya Shah',vehicle:'MH-02-CD-5678',route:'Surat â†’ Vadodara',status:'loading',eta:'16:00'},
  {driver:'Rohan Das',vehicle:'GJ-05-EF-9012',route:'Ahmedabad â†’ Rajkot',status:'on-route',eta:'17:15'},
  {driver:'Sneha Patel',vehicle:'MH-04-GH-3456',route:'Nashik â†’ Aurangabad',status:'delayed',eta:'18:45'},
];

const UTILIZATION = [
  {id:'MH-01-AB-1234',type:'Truck',pct:84},
  {id:'MH-02-CD-5678',type:'Van',pct:61},
  {id:'GJ-05-EF-9012',type:'Truck',pct:92},
  {id:'MH-04-GH-3456',type:'SUV',pct:37},
  {id:'RJ-14-XY-0099',type:'Truck',pct:55},
];

const VEHICLES = [
  {id:'MH-01-AB-1234',type:'Truck',model:'Tata Prima 4928.S',driver:'Arjun Mehta',fuel:72,km:'1,24,300',status:'active',color:'#3b82f6'},
  {id:'MH-02-CD-5678',type:'Van',model:'Tata Ace Gold',driver:'Priya Shah',fuel:45,km:'88,200',status:'active',color:'#22c55e'},
  {id:'GJ-05-EF-9012',type:'Truck',model:'Ashok Leyland Dost+',driver:'Rohan Das',fuel:88,km:'2,02,410',status:'active',color:'#8b5cf6'},
  {id:'MH-04-GH-3456',type:'SUV',model:'Mahindra Bolero Pik-Up',driver:'Sneha Patel',fuel:30,km:'56,780',status:'service',color:'#f59e0b'},
  {id:'RJ-14-XY-0099',type:'Truck',model:'Eicher Pro 2049',driver:'Vikram Singh',fuel:60,km:'1,78,900',status:'active',color:'#06b6d4'},
  {id:'KA-09-XY-2233',type:'Van',model:'Force Traveller 26',driver:'Kiran Bhat',fuel:15,km:'94,100',status:'service',color:'#ef4444'},
  {id:'MH-07-PQ-4455',type:'Truck',model:'Tata LPT 1615',driver:'Unassigned',fuel:90,km:'44,300',status:'idle',color:'#ec4899'},
  {id:'GJ-01-MN-8899',type:'Pickup',model:'Tata Xenon XT',driver:'Ramesh Kumar',fuel:55,km:'1,12,600',status:'active',color:'#3b82f6'},
];

const MAINTENANCE_TIMELINE = [
  {icon:'ğŸ”´',color:'rgba(239,68,68,0.2)',border:'#ef4444',title:'Oil Change Overdue',sub:'MH-04-GH-3456 â€” Mahindra Bolero',date:'Due: 15 Feb 2025'},
  {icon:'ğŸ”´',color:'rgba(239,68,68,0.2)',border:'#ef4444',title:'Tyre Rotation Overdue',sub:'KA-09-XY-2233 â€” Force Traveller',date:'Due: 18 Feb 2025'},
  {icon:'ğŸŸ¡',color:'rgba(245,158,11,0.2)',border:'#f59e0b',title:'Brake Inspection',sub:'MH-01-AB-1234 â€” Tata Prima',date:'Due: 25 Feb 2025'},
  {icon:'ğŸŸ¡',color:'rgba(245,158,11,0.2)',border:'#f59e0b',title:'Engine Tune-up',sub:'GJ-05-EF-9012 â€” Ashok Leyland',date:'Due: 28 Feb 2025'},
  {icon:'ğŸŸ¡',color:'rgba(245,158,11,0.2)',border:'#f59e0b',title:'Full Service',sub:'RJ-14-XY-0099 â€” Eicher Pro',date:'Due: 02 Mar 2025'},
  {icon:'ğŸŸ¢',color:'rgba(34,197,94,0.15)',border:'#22c55e',title:'AC Service',sub:'MH-02-CD-5678 â€” Tata Ace',date:'Due: 15 Mar 2025'},
];

const SERVICE_HISTORY = [
  {vehicle:'MH-01-AB-1234',service:'Oil Change',cost:'â‚¹3,200',date:'10 Feb',status:'done'},
  {vehicle:'GJ-05-EF-9012',service:'Tyre Rotation',cost:'â‚¹1,800',date:'05 Feb',status:'done'},
  {vehicle:'MH-07-PQ-4455',service:'Full Service',cost:'â‚¹12,400',date:'28 Jan',status:'done'},
  {vehicle:'MH-02-CD-5678',service:'Brake Pads',cost:'â‚¹5,600',date:'22 Jan',status:'done'},
  {vehicle:'RJ-14-XY-0099',service:'Engine Tune-up',cost:'â‚¹8,200',date:'15 Jan',status:'done'},
];

const VEHICLE_HEALTH = [
  {vehicle:'MH-01-AB-1234',last:'10 Feb',next:'25 Feb',km:'1,24,300',engine:'ğŸŸ¢',tyres:'ğŸŸ¡',status:'good'},
  {vehicle:'MH-02-CD-5678',last:'22 Jan',next:'15 Mar',km:'88,200',engine:'ğŸŸ¢',tyres:'ğŸŸ¢',status:'good'},
  {vehicle:'GJ-05-EF-9012',last:'05 Feb',next:'28 Feb',km:'2,02,410',engine:'ğŸŸ¡',tyres:'ğŸŸ¢',status:'due'},
  {vehicle:'MH-04-GH-3456',last:'14 Jan',next:'15 Feb',km:'56,780',engine:'ğŸ”´',tyres:'ğŸ”´',status:'overdue'},
  {vehicle:'RJ-14-XY-0099',last:'15 Jan',next:'02 Mar',km:'1,78,900',engine:'ğŸŸ¢',tyres:'ğŸŸ¡',status:'due'},
  {vehicle:'KA-09-XY-2233',last:'10 Dec',next:'18 Feb',km:'94,100',engine:'ğŸ”´',tyres:'ğŸŸ¡',status:'overdue'},
];

const EXPENSES_DATA = [
  {date:'21 Feb',vehicle:'MH-01-AB-1234',cat:'fuel',desc:'Fuel fill-up â€” HP Petrol Pump, Pune',amount:'â‚¹4,800',by:'Arjun M.'},
  {date:'20 Feb',vehicle:'MH-04-GH-3456',cat:'maintenance',desc:'Brake pad replacement',amount:'â‚¹5,600',by:'Admin'},
  {date:'20 Feb',vehicle:'GJ-05-EF-9012',cat:'fuel',desc:'Diesel â€” IOCL, Ahmedabad',amount:'â‚¹6,200',by:'Rohan D.'},
  {date:'19 Feb',vehicle:'MH-02-CD-5678',cat:'other',desc:'Toll â€” Mumbai-Pune Expressway',amount:'â‚¹380',by:'Priya S.'},
  {date:'19 Feb',vehicle:'KA-09-XY-2233',cat:'maintenance',desc:'Oil change + filter',amount:'â‚¹3,200',by:'Admin'},
  {date:'18 Feb',vehicle:'RJ-14-XY-0099',cat:'fuel',desc:'Diesel â€” Bharat Petroleum, Jaipur',amount:'â‚¹5,400',by:'Vikram S.'},
  {date:'17 Feb',vehicle:'MH-07-PQ-4455',cat:'other',desc:'Insurance renewal premium',amount:'â‚¹18,400',by:'Admin'},
  {date:'16 Feb',vehicle:'MH-01-AB-1234',cat:'fuel',desc:'Fuel fill-up â€” Nashik highway',amount:'â‚¹4,200',by:'Arjun M.'},
];

const DRIVERS = [
  {name:'Arjun Mehta',id:'DRV-001',phone:'+91 98765 43210',vehicle:'MH-01-AB-1234',trips:284,km:'48,200',rating:4.8,status:'active',exp:8,color:'#3b82f6',initials:'AM'},
  {name:'Priya Shah',id:'DRV-002',phone:'+91 87654 32109',vehicle:'MH-02-CD-5678',trips:211,km:'38,400',rating:4.9,status:'active',exp:5,color:'#ec4899',initials:'PS'},
  {name:'Rohan Das',id:'DRV-003',phone:'+91 76543 21098',vehicle:'GJ-05-EF-9012',trips:198,km:'41,600',rating:4.6,status:'active',exp:6,color:'#8b5cf6',initials:'RD'},
  {name:'Sneha Patel',id:'DRV-004',phone:'+91 65432 10987',vehicle:'MH-04-GH-3456',trips:156,km:'28,800',rating:4.7,status:'active',exp:4,color:'#22c55e',initials:'SP'},
  {name:'Vikram Singh',id:'DRV-005',phone:'+91 54321 09876',vehicle:'RJ-14-XY-0099',trips:312,km:'62,300',rating:4.5,status:'off',exp:12,color:'#f59e0b',initials:'VS'},
  {name:'Kiran Bhat',id:'DRV-006',phone:'+91 43210 98765',vehicle:'KA-09-XY-2233',trips:144,km:'22,100',rating:4.8,status:'active',exp:3,color:'#06b6d4',initials:'KB'},
  {name:'Ramesh Kumar',id:'DRV-007',phone:'+91 32109 87654',vehicle:'GJ-01-MN-8899',trips:267,km:'44,900',rating:4.4,status:'off',exp:9,color:'#ef4444',initials:'RK'},
  {name:'Deepa Nair',id:'DRV-008',phone:'+91 21098 76543',vehicle:'Unassigned',trips:89,km:'14,200',rating:4.9,status:'off',exp:2,color:'#3b82f6',initials:'DN'},
];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAVIGATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function navigate(page) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('page-' + page).classList.add('active');
  document.querySelector(`[data-page="${page}"]`).classList.add('active');
  // Re-trigger bar animations on page switch
  setTimeout(() => {
    document.querySelectorAll('.bar-fill').forEach(el => { el.style.height='0'; el.style.width='0'; setTimeout(() => { if(el.dataset.pct) el.style.height = el.dataset.pct+'%'; if(el.dataset.wpct) el.style.width = el.dataset.wpct+'%'; }, 50); });
    document.querySelectorAll('.prog-fill, .util-bar, .vc-fuel-fill').forEach(el => { const w = el.dataset.w; if(w){ el.style.width='0'; setTimeout(() => el.style.width = w, 50); } });
    document.querySelectorAll('.al-item').forEach(el => { io.unobserve(el); io.observe(el); });
  }, 50);
}
document.querySelectorAll('.nav-item[data-page]').forEach(item => {
  item.addEventListener('click', () => navigate(item.dataset.page));
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.getElementById('todayDate').textContent =
  new Date().toLocaleDateString('en-IN', {weekday:'long',year:'numeric',month:'long',day:'numeric'});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BAR CHART BUILDER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildBarChart(container, data, colorClass='') {
  const max = Math.max(...data.map(d => d.val));
  container.innerHTML = data.map((d, i) =>
    `<div class="bar-col">
       <span class="bar-val">${d.val}</span>
       <div class="bar-track"><div class="bar-fill ${colorClass}" data-pct="${(d.val/max*100).toFixed(1)}" style="transition-delay:${0.35+i*0.07}s"></div></div>
       <span class="bar-day">${d.day}</span>
     </div>`
  ).join('');
}
buildBarChart(document.getElementById('weeklyChart'), WEEKLY);
buildBarChart(document.getElementById('tripMonthChart'), MONTHLY_TRIPS, 'green');
buildBarChart(document.getElementById('expenseChart'), EXPENSE_MONTHS, 'amber');

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ANIMATED LIST ENGINE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const io = new IntersectionObserver(entries => {
  entries.forEach(e => e.isIntersecting ? e.target.classList.add('visible') : e.target.classList.remove('visible'));
}, { threshold: 0.3 });

function buildAL(scrollEl, items, renderFn) {
  scrollEl.innerHTML = '';
  items.forEach((item, i) => {
    const w = document.createElement('div');
    w.className = 'al-item';
    w.innerHTML = renderFn(item, i);
    w.style.transitionDelay = `${i * 0.055}s`;
    w.addEventListener('mouseenter', () => {
      scrollEl.querySelectorAll('.al-item > *').forEach(c => c.classList.remove('selected'));
      w.querySelector(':first-child')?.classList.add('selected');
    });
    scrollEl.appendChild(w);
    io.observe(w);
  });
  const container = scrollEl.closest('.al-container');
  if(!container) return;
  const top = container.querySelector('.al-grad-top');
  const bot = container.querySelector('.al-grad-bot');
  scrollEl.addEventListener('scroll', () => {
    const {scrollTop, scrollHeight, clientHeight} = scrollEl;
    if(top) top.style.opacity = Math.min(scrollTop/40, 1);
    if(bot) bot.style.opacity = scrollHeight <= clientHeight ? 0 : Math.min((scrollHeight-scrollTop-clientHeight)/40, 1);
  });
  setTimeout(() => { if(bot) bot.style.opacity = scrollEl.scrollHeight > scrollEl.clientHeight ? 1 : 0; }, 100);
}

/* â”€â”€â”€ Dashboard: Activity â”€â”€â”€ */
buildAL(document.getElementById('activityScroll'), ACTIVITY, a =>
  `<div class="activity-item" style="display:flex;align-items:flex-start;gap:12px;padding:10px 12px;border-radius:10px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.07);cursor:pointer;transition:background .18s,border-color .18s">
    <div style="width:30px;height:30px;border-radius:8px;background:${a.color}22;display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0">${a.icon}</div>
    <div><div style="font-size:13px;color:#94a3b8;line-height:1.4">${a.text}</div><div style="font-size:11px;color:#475569;margin-top:3px">${a.time}</div></div>
   </div>`
);

/* â”€â”€â”€ Dashboard: Active Trips â”€â”€â”€ */
const statusMap = {'on-route':['pill-green','On Route'],'loading':['pill-blue','Loading'],'delayed':['pill-amber','Delayed']};
buildAL(document.getElementById('tripsScroll'), ACTIVE_TRIPS_DASH, t => {
  const [cls, lbl] = statusMap[t.status];
  const p = t.driver.split(' ');
  return `<div style="display:grid;grid-template-columns:1.2fr 1.3fr 1.6fr 1fr 0.7fr;gap:8px;align-items:center;padding:12px 14px;border-radius:10px;background:rgba(255,255,255,0.025);border:1px solid rgba(255,255,255,0.07);cursor:pointer;transition:all .18s">
    <div><div style="font-size:13px;color:#f1f5f9;font-weight:600">${p[0]}</div><div style="font-size:11px;color:#475569">${p[1]}</div></div>
    <div style="font-size:11px;color:#94a3b8;font-family:'JetBrains Mono',monospace">${t.vehicle.slice(-8)}</div>
    <div style="font-size:12px;color:#94a3b8">${t.route}</div>
    <span class="pill ${cls}">${lbl}</span>
    <div style="font-size:13px;color:#60a5fa;font-family:'JetBrains Mono',monospace;font-weight:600">${t.eta}</div>
   </div>`;
});

/* â”€â”€â”€ Dashboard: Utilization â”€â”€â”€ */
const utilEl = document.getElementById('utilizationList');
UTILIZATION.forEach(v => {
  const col = v.pct>80?'#22c55e':v.pct>50?'#3b82f6':'#f59e0b';
  const grad = v.pct>80?'#22c55e,#4ade80':v.pct>50?'#3b82f6,#60a5fa':'#f59e0b,#fbbf24';
  utilEl.innerHTML += `
    <div style="padding:10px 0;border-bottom:1px solid rgba(255,255,255,0.04)">
      <div style="display:flex;justify-content:space-between;margin-bottom:7px">
        <div><span style="font-size:12px;color:#f1f5f9;font-family:'JetBrains Mono',monospace">${v.id.slice(-8)}</span><span style="font-size:11px;color:#475569;margin-left:8px">${v.type}</span></div>
        <span style="font-size:13px;font-weight:700;color:${col}">${v.pct}%</span>
      </div>
      <div class="prog-track"><div class="prog-fill" data-w="${v.pct}%" style="background:linear-gradient(90deg,${grad});transition-delay:0.5s"></div></div>
    </div>`;
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VEHICLES PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderVehicles(filter='all', search='') {
  const grid = document.getElementById('vehicleGrid');
  const filtered = VEHICLES.filter(v => {
    const matchFilter = filter==='all' || v.status===filter;
    const matchSearch = !search || v.id.toLowerCase().includes(search) || v.model.toLowerCase().includes(search) || v.driver.toLowerCase().includes(search);
    return matchFilter && matchSearch;
  });
  grid.innerHTML = filtered.map((v, i) => {
    const statusBadge = {active:'badge-green',service:'badge-amber',idle:'badge-gray'}[v.status];
    const statusLabel = {active:'Active',service:'In Service',idle:'Idle'}[v.status];
    const fuelColor = v.fuel>60?'#22c55e':v.fuel>30?'#f59e0b':'#ef4444';
    return `<div class="vehicle-card" style="animation-delay:${i*0.06}s">
      <div class="vehicle-card-glow" style="background:radial-gradient(circle,${v.color}18,transparent 70%)"></div>
      <div class="vc-type">${v.type}</div>
      <div class="vc-id">${v.id}</div>
      <div class="vc-model">${v.model}</div>
      <div class="vc-stat-row">
        <div class="vc-stat"><div class="vc-stat-val">${v.km} km</div><div class="vc-stat-lbl">Odometer</div></div>
        <div class="vc-stat"><div class="vc-stat-val" style="color:${fuelColor}">${v.fuel}%</div><div class="vc-stat-lbl">Fuel</div></div>
      </div>
      <div class="vc-fuel-bar">
        <div class="vc-fuel-fill" data-w="${v.fuel}%" style="background:linear-gradient(90deg,${fuelColor},${fuelColor}aa)"></div>
      </div>
      <div class="vc-footer">
        <div style="font-size:12px;color:#94a3b8">ğŸ‘¤ ${v.driver}</div>
        <span class="badge ${statusBadge}">${statusLabel}</span>
      </div>
    </div>`;
  }).join('') || '<div class="empty-state"><div class="emoji">ğŸ”</div><p>No vehicles found</p></div>';
  setTimeout(() => {
    document.querySelectorAll('.vc-fuel-fill').forEach(el => { el.style.width = '0'; setTimeout(() => el.style.width = el.dataset.w, 100); });
  }, 100);
}
window.vehicleFilter = 'all';
function filterVehicles() { renderVehicles(window.vehicleFilter, document.getElementById('vehicleSearch').value.toLowerCase()); }
function setVehicleFilter(btn, f) {
  window.vehicleFilter = f;
  document.querySelectorAll('#page-vehicles .filter-tab').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  filterVehicles();
}
renderVehicles();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TRIPS PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderTrips(filter='all') {
  const tbody = document.getElementById('tripsTable');
  const data = filter==='all' ? TRIPS_DATA : TRIPS_DATA.filter(t => t.status===filter);
  const pillMap = {active:'pill-blue',delayed:'pill-amber',completed:'pill-green',cancelled:'pill-red'};
  const labMap = {active:'Active',delayed:'Delayed',completed:'Completed',cancelled:'Cancelled'};
  tbody.innerHTML = data.map(t => `
    <tr>
      <td class="td-mono">${t.id}</td>
      <td class="td-name">${t.driver}</td>
      <td class="td-mono" style="font-size:12px">${t.vehicle}</td>
      <td>${t.route}</td>
      <td style="color:#475569">${t.dist}</td>
      <td><span class="pill ${pillMap[t.status]}">${labMap[t.status]}</span></td>
      <td style="color:#475569;font-size:12px">${t.date}</td>
      <td><button class="btn btn-ghost btn-sm">View</button></td>
    </tr>`).join('') || `<tr><td colspan="8"><div class="empty-state"><div class="emoji">ğŸ›£ï¸</div><p>No trips found</p></div></td></tr>`;
}
function setTripFilter(btn, f) {
  document.querySelectorAll('#page-trips .filter-tab').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderTrips(f);
}
renderTrips();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAINTENANCE PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const tlEl = document.getElementById('maintenanceTimeline');
tlEl.innerHTML = MAINTENANCE_TIMELINE.map((m, i) => `
  <div class="tl-item" style="animation-delay:${i*0.07}s">
    <div class="tl-left">
      <div class="tl-dot" style="background:${m.color};border-color:${m.border}">${m.icon}</div>
      <div class="tl-line"></div>
    </div>
    <div class="tl-content">
      <div class="tl-title">${m.title}</div>
      <div class="tl-sub">${m.sub}</div>
      <div class="tl-date">${m.date}</div>
    </div>
    <button class="btn btn-ghost btn-sm" style="align-self:center;flex-shrink:0">Schedule</button>
  </div>`).join('');

document.getElementById('serviceHistoryTable').innerHTML = SERVICE_HISTORY.map(s =>
  `<tr><td class="td-mono" style="font-size:12px">${s.vehicle}</td><td>${s.service}</td><td style="color:#60a5fa;font-family:'JetBrains Mono',monospace">${s.cost}</td><td style="color:#475569;font-size:12px">${s.date}</td><td><span class="pill pill-green">Done</span></td></tr>`
).join('');

const healthPill = {good:'<span class="pill pill-green">Healthy</span>', due:'<span class="pill pill-amber">Due Soon</span>', overdue:'<span class="pill pill-red">Overdue</span>'};
document.getElementById('vehicleHealthTable').innerHTML = VEHICLE_HEALTH.map(v =>
  `<tr><td class="td-mono td-name" style="font-size:12px">${v.vehicle}</td><td style="font-size:12px;color:#475569">${v.last}</td><td style="font-size:12px;color:#475569">${v.next}</td><td style="font-size:12px;color:#475569">${v.km}</td><td style="font-size:18px">${v.engine}</td><td style="font-size:18px">${v.tyres}</td><td>${healthPill[v.status]}</td></tr>`
).join('');

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EXPENSES PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const catBadge = {fuel:'badge-brand',maintenance:'badge-violet',other:'badge-gray'};
const catLabel = {fuel:'Fuel',maintenance:'Maintenance',other:'Other'};
function renderExpenses(filter='all') {
  const data = filter==='all' ? EXPENSES_DATA : EXPENSES_DATA.filter(e => e.cat===filter);
  document.getElementById('expensesTable').innerHTML = data.map(e =>
    `<tr><td style="font-size:12px;color:#475569;font-family:'JetBrains Mono',monospace">${e.date}</td><td class="td-mono" style="font-size:12px">${e.vehicle}</td><td><span class="badge ${catBadge[e.cat]}">${catLabel[e.cat]}</span></td><td style="font-size:13px">${e.desc}</td><td style="color:#60a5fa;font-family:'JetBrains Mono',monospace;font-weight:600">${e.amount}</td><td style="color:#475569;font-size:12px">${e.by}</td></tr>`
  ).join('');
}
function setExpFilter(btn, f) {
  document.querySelectorAll('#page-expenses .filter-tab').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderExpenses(f);
}
renderExpenses();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DRIVERS PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderDrivers(filter='all') {
  const grid = document.getElementById('driverGrid');
  const data = filter==='all' ? DRIVERS :
    filter==='active' ? DRIVERS.filter(d=>d.status==='active') :
    filter==='off'    ? DRIVERS.filter(d=>d.status==='off') :
    DRIVERS.filter(d=>d.rating>=4.8);
  grid.innerHTML = data.map((d, i) => {
    const stars = 'â˜…'.repeat(Math.round(d.rating)) + 'â˜†'.repeat(5-Math.round(d.rating));
    return `<div class="driver-card" style="animation-delay:${i*0.06}s">
      <div class="driver-avatar" style="background:linear-gradient(135deg,${d.color},${d.color}aa)">${d.initials}</div>
      <div class="driver-name-card">${d.name}</div>
      <div class="driver-meta">${d.id} Â· ${d.exp} yrs exp</div>
      <div class="rating-stars">${stars}</div>
      <div class="driver-stats">
        <div><div class="driver-stat-val">${d.trips}</div><div class="driver-stat-lbl">Trips</div></div>
        <div><div class="driver-stat-val">${d.rating}</div><div class="driver-stat-lbl">Rating</div></div>
      </div>
      <div style="font-size:12px;color:#475569;margin-bottom:12px">ğŸš— ${d.vehicle}</div>
      <span class="badge ${d.status==='active'?'badge-green':'badge-gray'}">${d.status==='active'?'â— On Duty':'Off Duty'}</span>
    </div>`;
  }).join('') || '<div class="empty-state"><div class="emoji">ğŸ‘¤</div><p>No drivers found</p></div>';
}
function setDriverFilter(btn, f) {
  document.querySelectorAll('#page-drivers .filter-tab').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderDrivers(f);
}
renderDrivers();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SETTINGS NAV
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function setSettingsTab(btn, tab) {
  document.querySelectorAll('.settings-nav-item').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('.settings-section').forEach(s => s.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('settings-' + tab).classList.add('active');
}

/* Color swatches */
document.querySelectorAll('.color-swatch').forEach(sw => {
  sw.addEventListener('click', () => {
    document.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('active'));
    sw.classList.add('active');
  });
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODAL HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openModal(id)  { document.getElementById(id).classList.add('open'); }
function closeModal(id) {
  document.getElementById(id).classList.remove('open');
  clearForm(id);
}
function clearForm(modalId) {
  document.querySelectorAll('#' + modalId + ' input, #' + modalId + ' select, #' + modalId + ' textarea').forEach(el => {
    if (el.tagName === 'SELECT') el.selectedIndex = 0;
    else el.value = '';
  });
}
function gv(id) { const e = document.getElementById(id); return e ? e.value.trim() : ''; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let _toastTimer;
function toast(msg, type='success') {
  let el = document.getElementById('ff-toast');
  if (!el) {
    el = document.createElement('div');
    el.id = 'ff-toast';
    el.className = 'ff-toast';
    document.body.appendChild(el);
  }
  el.className = 'ff-toast ' + type;
  el.innerHTML = (type === 'success' ? 'âœ… ' : 'âŒ ') + msg;
  clearTimeout(_toastTimer);
  requestAnimationFrame(() => el.classList.add('show'));
  _toastTimer = setTimeout(() => el.classList.remove('show'), 3200);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PERSISTENT AUTH â€” load user from localStorage
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
(function loadUser() {
  try {
    const raw = localStorage.getItem('ff_user');
    const u   = raw ? JSON.parse(raw) : {};
    const full     = [u.firstName, u.lastName].filter(Boolean).join(' ') || 'Admin';
    const initials = ((u.firstName || 'A')[0] + (u.lastName || 'D')[0]).toUpperCase();
    const email    = u.email || '';
    const phone    = u.phone || '';
    const role     = u.role  || 'Fleet Administrator';

    // Sidebar & dropup
    document.getElementById('sidebarAvatar').textContent = initials;
    document.getElementById('sidebarName').textContent   = full;
    document.getElementById('sidebarRole').textContent   = role;
    document.getElementById('dropupAvatar').textContent  = initials;
    document.getElementById('dropupName').textContent    = full;
    document.getElementById('dropupEmail').textContent   = email || 'admin@fleetflow.in';

    // Settings profile panel
    const sdn = document.getElementById('settingsDisplayName');
    const srl = document.getElementById('settingsRoleLabel');
    const snm = document.getElementById('settingsName');
    const sem = document.getElementById('settingsEmail');
    const sph = document.getElementById('settingsPhone');
    const sro = document.getElementById('settingsRole');
    if (sdn) sdn.textContent = full;
    if (srl) srl.textContent = role;
    if (snm) snm.value = full;
    if (sem) sem.value = email;
    if (sph) sph.value = phone;
    if (sro) { Array.from(sro.options).forEach(o => { if (o.text.toLowerCase().includes(role.toLowerCase())) o.selected = true; }); }

    // Dashboard greeting
    const title = document.querySelector('#page-dashboard .page-title');
    if (title) {
      const hr = new Date().getHours();
      const greet = hr < 12 ? 'Good morning' : hr < 17 ? 'Good afternoon' : 'Good evening';
      title.textContent = greet + ', ' + (u.firstName || 'Admin') + ' ğŸ‘‹';
    }
  } catch(e) {}
})();

/* Save Changes in Settings */
function saveSettings() {
  try {
    const raw = localStorage.getItem('ff_user');
    const u   = raw ? JSON.parse(raw) : {};
    const newName  = document.getElementById('settingsName')?.value.trim() || '';
    const newEmail = document.getElementById('settingsEmail')?.value.trim() || '';
    const newPhone = document.getElementById('settingsPhone')?.value.trim() || '';
    const newRole  = document.getElementById('settingsRole')?.value || u.role || 'Fleet Administrator';
    if (newName) {
      const parts = newName.split(' ');
      u.firstName = parts[0]; u.lastName = parts.slice(1).join(' ');
    }
    if (newEmail) u.email = newEmail;
    if (newPhone) u.phone = newPhone;
    u.role = newRole;
    localStorage.setItem('ff_user', JSON.stringify(u));
    // Re-apply everywhere
    const full     = [u.firstName, u.lastName].filter(Boolean).join(' ') || 'Admin';
    const initials = ((u.firstName||'A')[0]+(u.lastName||'D')[0]).toUpperCase();
    document.getElementById('sidebarAvatar').textContent = initials;
    document.getElementById('sidebarName').textContent   = full;
    document.getElementById('sidebarRole').textContent   = newRole;
    document.getElementById('dropupAvatar').textContent  = initials;
    document.getElementById('dropupName').textContent    = full;
    document.getElementById('dropupEmail').textContent   = newEmail || u.email || '';
    const sdn = document.getElementById('settingsDisplayName');
    const srl = document.getElementById('settingsRoleLabel');
    if (sdn) sdn.textContent = full;
    if (srl) srl.textContent = newRole;
    const title = document.querySelector('#page-dashboard .page-title');
    if (title) { const hr=new Date().getHours(); const g=hr<12?'Good morning':hr<17?'Good afternoon':'Good evening'; title.textContent=g+', '+(u.firstName||'Admin')+' ğŸ‘‹'; }
    toast('Settings saved successfully!');
  } catch(e) { toast('Could not save settings','error'); }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DROPUP PROFILE MENU
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toggleDropup(e) {
  e.stopPropagation();
  const menu  = document.getElementById('dropupMenu');
  const arrow = document.getElementById('dropupArrow');
  const open  = menu.classList.toggle('open');
  arrow.textContent = open ? 'â–¼' : 'â–²';
}
function closeDropup() {
  const menu  = document.getElementById('dropupMenu');
  const arrow = document.getElementById('dropupArrow');
  if (!menu) return;
  menu.classList.remove('open');
  arrow.textContent = 'â–²';
}
document.addEventListener('click', closeDropup);
document.getElementById('dropupMenu').addEventListener('click', e => e.stopPropagation());

function doLogout() {
  if (!confirm('Sign out of FleetFlow?')) return;
  localStorage.removeItem('ff_user');
  localStorage.removeItem('ff_token');
  // Try redirect to register, fall back to reload
  try { window.location.href = 'register.html'; } catch(e) { location.reload(); }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NEXT TRIP ID HELPER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function nextTripId() {
  const ids = TRIPS_DATA.map(t => parseInt(t.id.replace('#','')) || 0);
  return '#' + (Math.max(...ids) + 1);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   REBUILD DASHBOARD LIVE LISTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function rebuildDash() {
  // Activity
  buildAL(document.getElementById('activityScroll'), ACTIVITY.slice(0,10), a =>
    `<div class="activity-item" style="display:flex;align-items:flex-start;gap:12px;padding:10px 12px;border-radius:10px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.07);cursor:pointer;transition:background .18s,border-color .18s">
      <div style="width:30px;height:30px;border-radius:8px;background:${a.color}22;display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0">${a.icon}</div>
      <div><div style="font-size:13px;color:#94a3b8;line-height:1.4">${a.text}</div><div style="font-size:11px;color:#475569;margin-top:3px">${a.time}</div></div>
     </div>`
  );
  // Active trips
  const sm = {'on-route':['pill-green','On Route'],'loading':['pill-blue','Loading'],'delayed':['pill-amber','Delayed']};
  buildAL(document.getElementById('tripsScroll'), ACTIVE_TRIPS_DASH.slice(0,6), t => {
    const [cls,lbl] = sm[t.status] || ['pill-gray','â€”'];
    const p = (t.driver||'').split(' ');
    return `<div style="display:grid;grid-template-columns:1.2fr 1.3fr 1.6fr 1fr 0.7fr;gap:8px;align-items:center;padding:12px 14px;border-radius:10px;background:rgba(255,255,255,0.025);border:1px solid rgba(255,255,255,0.07);cursor:pointer;transition:all .18s">
      <div><div style="font-size:13px;color:#f1f5f9;font-weight:600">${p[0]||''}</div><div style="font-size:11px;color:#475569">${p[1]||''}</div></div>
      <div style="font-size:11px;color:#94a3b8;font-family:'JetBrains Mono',monospace">${(t.vehicle||'').slice(-8)}</div>
      <div style="font-size:12px;color:#94a3b8">${t.route}</div>
      <span class="pill ${cls}">${lbl}</span>
      <div style="font-size:13px;color:#60a5fa;font-family:'JetBrains Mono',monospace;font-weight:600">${t.eta}</div>
     </div>`;
  });
  // Update stat cards on dashboard
  const active = TRIPS_DATA.filter(t=>t.status==='active').length;
  const dueMaint = MAINTENANCE_TIMELINE.filter(m=>m.icon==='ğŸ”´'||m.icon==='ğŸŸ¡').length;
  const dc = document.querySelectorAll('#page-dashboard .stat-card .stat-value');
  if (dc[0]) dc[0].textContent = VEHICLES.length;
  if (dc[1]) dc[1].textContent = active;
  if (dc[2]) dc[2].textContent = dueMaint;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SUBMIT: NEW TRIP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function submitTrip() {
  const driver  = gv('nt-driver');
  const vehicle = gv('nt-vehicle');
  const origin  = gv('nt-origin');
  const dest    = gv('nt-dest');
  const depart  = gv('nt-depart');
  const dist    = gv('nt-dist');

  if (!driver || !vehicle || !origin || !dest) {
    toast('Driver, vehicle, origin & destination are required', 'error'); return;
  }

  const id   = nextTripId();
  const date = depart ? new Date(depart).toLocaleDateString('en-IN',{day:'2-digit',month:'short'}) : 'Today';
  const eta  = depart ? new Date(depart).toLocaleTimeString('en-IN',{hour:'2-digit',minute:'2-digit',hour12:false}) : '--:--';

  // Add to all-trips table
  TRIPS_DATA.unshift({ id, driver, vehicle, route: origin+' â†’ '+dest, dist: dist ? dist+' km' : 'â€”', status:'active', date });

  // Add to dashboard active trips
  ACTIVE_TRIPS_DASH.unshift({ driver, vehicle, route: origin+' â†’ '+dest, status:'on-route', eta });

  // Add to activity feed
  ACTIVITY.unshift({ icon:'ğŸš—', text: driver+' dispatched â€” '+origin+' â†’ '+dest, time:'Just now', color:'#3b82f6' });

  renderTrips();
  rebuildDash();
  closeModal('modal-new-trip');
  toast('Trip '+id+' created â€” '+origin+' â†’ '+dest);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SUBMIT: ADD VEHICLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function submitVehicle() {
  const reg   = gv('av-reg').toUpperCase();
  const type  = gv('av-type');
  const make  = gv('av-make');
  const model = gv('av-model');
  const year  = gv('av-year');
  const fuel  = gv('av-fuel');
  const drv   = gv('av-driver') || 'Unassigned';
  const km    = gv('av-km') || '0';

  if (!reg || !make || !model) { toast('Registration, Make and Model are required', 'error'); return; }
  if (VEHICLES.find(v => v.id === reg)) { toast('Vehicle '+reg+' already exists', 'error'); return; }

  const newV = { id:reg, type, model:make+' '+model+(year?' '+year:''), driver:drv, fuel:80, km:parseInt(km).toLocaleString('en-IN'), status:'active', color:'#3b82f6' };
  VEHICLES.unshift(newV);

  ACTIVITY.unshift({ icon:'ğŸš—', text:'New vehicle '+reg+' added to fleet', time:'Just now', color:'#3b82f6' });

  renderVehicles(window.vehicleFilter||'all');
  rebuildDash();
  closeModal('modal-add-vehicle');
  toast('Vehicle '+reg+' added to fleet');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SUBMIT: SCHEDULE MAINTENANCE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function submitMaintenance() {
  const vehicle = gv('am-vehicle');
  const type    = gv('am-type');
  const date    = gv('am-date');
  const center  = gv('am-center');
  const cost    = gv('am-cost');

  if (!vehicle || !type || !date) { toast('Vehicle, service type and date are required', 'error'); return; }

  const fmtDate = new Date(date).toLocaleDateString('en-IN',{day:'2-digit',month:'short',year:'numeric'});
  const isPast  = new Date(date) < new Date();
  const icon    = isPast ? 'ğŸ”´' : 'ğŸŸ¡';
  const color   = isPast ? 'rgba(239,68,68,0.2)' : 'rgba(245,158,11,0.2)';
  const border  = isPast ? '#ef4444' : '#f59e0b';

  MAINTENANCE_TIMELINE.unshift({ icon, color, border, title:type, sub:vehicle+(center?' â€” '+center:''), date:'Due: '+fmtDate });

  // Re-render full timeline
  const tlEl = document.getElementById('maintenanceTimeline');
  tlEl.innerHTML = MAINTENANCE_TIMELINE.map((m,i) => `
    <div class="tl-item" style="animation-delay:${i*0.06}s">
      <div class="tl-left">
        <div class="tl-dot" style="background:${m.color};border-color:${m.border}">${m.icon}</div>
        <div class="tl-line"></div>
      </div>
      <div class="tl-content">
        <div class="tl-title">${m.title}</div>
        <div class="tl-sub">${m.sub}</div>
        <div class="tl-date">${m.date}</div>
      </div>
      <button class="btn btn-ghost btn-sm" style="align-self:center;flex-shrink:0">View</button>
    </div>`).join('');

  // Update overdue count badge
  const overdue = MAINTENANCE_TIMELINE.filter(m=>m.icon==='ğŸ”´').length;
  const badge   = document.querySelector('#page-maintenance .badge-red');
  if (badge) badge.textContent = overdue + ' urgent';

  // Update maint stat cards
  const mc = document.querySelectorAll('#page-maintenance .stat-card .stat-value');
  if (mc[0]) mc[0].textContent = MAINTENANCE_TIMELINE.filter(m=>m.icon==='ğŸ”´').length;
  if (mc[1]) mc[1].textContent = MAINTENANCE_TIMELINE.filter(m=>m.icon==='ğŸŸ¡').length;

  ACTIVITY.unshift({ icon:'ğŸ”§', text:type+' scheduled for '+vehicle+(cost?' â€” â‚¹'+parseInt(cost).toLocaleString('en-IN'):''), time:'Just now', color:'#ec4899' });
  rebuildDash();
  closeModal('modal-add-maintenance');
  toast(type+' scheduled for '+vehicle);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SUBMIT: LOG EXPENSE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function submitExpense() {
  const vehicle = gv('ae-vehicle');
  const cat     = document.getElementById('ae-cat') ? document.getElementById('ae-cat').value : 'other';
  const amount  = gv('ae-amount');
  const date    = gv('ae-date');
  const desc    = gv('ae-desc');

  if (!vehicle || !amount || !date) { toast('Vehicle, amount and date are required', 'error'); return; }

  const fmtDate = new Date(date).toLocaleDateString('en-IN',{day:'2-digit',month:'short'});
  const amt     = parseInt(amount);
  const fmtAmt  = 'â‚¹'+amt.toLocaleString('en-IN');
  const catKey  = ['fuel','maintenance'].includes(cat) ? cat : 'other';
  const userName = (() => { try { const u=JSON.parse(localStorage.getItem('ff_user')||'{}'); return (u.firstName||'Admin')+(u.lastName?' '+u.lastName[0]+'.':''); } catch(e){ return 'Admin'; } })();

  EXPENSES_DATA.unshift({ date:fmtDate, vehicle, cat:catKey, desc:desc||cat, amount:fmtAmt, by:userName });
  renderExpenses();

  ACTIVITY.unshift({ icon:'ğŸ’°', text:'Expense '+fmtAmt+' logged for '+vehicle+(desc?' â€” '+desc:''), time:'Just now', color:'#8b5cf6' });
  rebuildDash();
  closeModal('modal-add-expense');
  toast('Expense '+fmtAmt+' logged successfully');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SUBMIT: ADD DRIVER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function submitDriver() {
  const name    = gv('ad-name');
  const phone   = gv('ad-phone');
  const license = gv('ad-license');
  const exp     = parseInt(gv('ad-exp')) || 0;
  const vehicle = gv('ad-vehicle') || 'Unassigned';

  if (!name || !phone) { toast('Name and phone number are required', 'error'); return; }

  const parts    = name.trim().split(' ');
  const initials = parts.map(p=>p[0]).join('').slice(0,2).toUpperCase();
  const palette  = ['#3b82f6','#ec4899','#8b5cf6','#22c55e','#f59e0b','#06b6d4','#ef4444'];
  const color    = palette[DRIVERS.length % palette.length];
  const newId    = 'DRV-' + String(DRIVERS.length+1).padStart(3,'0');

  DRIVERS.unshift({ name, id:newId, phone, vehicle, trips:0, km:'0', rating:4.5, status:'active', exp, color, initials });

  renderDrivers('all');

  // Update driver stat cards
  const dc2 = document.querySelectorAll('#page-drivers .stat-card .stat-value');
  if (dc2[0]) dc2[0].textContent = DRIVERS.length;
  if (dc2[1]) dc2[1].textContent = DRIVERS.filter(d=>d.status==='active').length;

  ACTIVITY.unshift({ icon:'ğŸ‘¤', text:'New driver '+name+' added to roster', time:'Just now', color:'#06b6d4' });
  rebuildDash();
  closeModal('modal-add-driver');
  toast('Driver '+name+' added successfully');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ANIMATE BARS ON LOAD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
setTimeout(() => {
  document.querySelectorAll('.bar-fill').forEach(el => {
    if (el.dataset.pct) { el.style.height = '0'; setTimeout(() => el.style.height = el.dataset.pct + '%', 50); }
  });
  document.querySelectorAll('.prog-fill,.util-bar,.vc-fuel-fill').forEach(el => {
    if (el.dataset.w) { el.style.width = '0'; setTimeout(() => el.style.width = el.dataset.w, 100); }
  });
}, 600);

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ANALYTICS PAGE DATA & RENDER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const ROI_DATA = [
  {vehicle:'MH-01-AB-1234',type:'Truck',rev:285000,fuel:42000,maint:18000,acq:1800000},
  {vehicle:'MH-02-CD-5678',type:'Van',  rev:198000,fuel:28000,maint:12000,acq:900000},
  {vehicle:'GJ-05-EF-9012',type:'Truck',rev:312000,fuel:48000,maint:22000,acq:2100000},
  {vehicle:'MH-04-GH-3456',type:'SUV',  rev:145000,fuel:21000,maint:34000,acq:1200000},
  {vehicle:'RJ-14-XY-0099',type:'Truck',rev:268000,fuel:39000,maint:16000,acq:1950000},
  {vehicle:'KA-09-XY-2233',type:'Van',  rev:162000,fuel:24000,maint:28000,acq:850000},
];
const PL_DATA = [
  {month:'Aug 2024',trips:98, rev:918000,costs:724000},
  {month:'Sep 2024',trips:112,rev:1048000,costs:810000},
  {month:'Oct 2024',trips:134,rev:1254000,costs:952000},
  {month:'Nov 2024',trips:118,rev:1104000,costs:868000},
  {month:'Dec 2024',trips:127,rev:1188000,costs:932000},
  {month:'Jan 2025',trips:142,rev:1328000,costs:1024000},
];
const REVENUE_CHART_DATA = PL_DATA.map(p => ({day: p.month.slice(0,3), val: Math.round(p.rev/1000)}));

function renderAnalytics() {
  // ROI Table
  document.getElementById('roiTable').innerHTML = ROI_DATA.map(r => {
    const roi = (((r.rev - r.fuel - r.maint) / r.acq) * 100).toFixed(1);
    const fuelEff = (Math.random()*2+5).toFixed(1);
    const roiColor = roi>10?'#22c55e':roi>5?'#f59e0b':'#ef4444';
    return `<tr>
      <td class="td-mono td-name" style="font-size:12px">${r.vehicle}</td>
      <td>${r.type}</td>
      <td style="color:#60a5fa;font-family:'JetBrains Mono',monospace">â‚¹${r.rev.toLocaleString('en-IN')}</td>
      <td style="color:#f87171;font-family:'JetBrains Mono',monospace">â‚¹${r.fuel.toLocaleString('en-IN')}</td>
      <td style="color:#fb923c;font-family:'JetBrains Mono',monospace">â‚¹${r.maint.toLocaleString('en-IN')}</td>
      <td style="color:#475569;font-family:'JetBrains Mono',monospace">â‚¹${r.acq.toLocaleString('en-IN')}</td>
      <td style="color:${roiColor};font-weight:700;font-family:'JetBrains Mono',monospace">${roi}%</td>
      <td style="color:#94a3b8">${fuelEff} km/L</td>
    </tr>`;
  }).join('');

  // P&L Table
  document.getElementById('plTable').innerHTML = PL_DATA.map(p => {
    const net = p.rev - p.costs;
    const margin = ((net/p.rev)*100).toFixed(1);
    const netColor = net>0?'#22c55e':'#ef4444';
    return `<tr>
      <td style="font-weight:600;color:var(--text1)">${p.month}</td>
      <td style="color:#94a3b8">${p.trips}</td>
      <td style="color:#60a5fa;font-family:'JetBrains Mono',monospace">â‚¹${p.rev.toLocaleString('en-IN')}</td>
      <td style="color:#f87171;font-family:'JetBrains Mono',monospace">â‚¹${p.costs.toLocaleString('en-IN')}</td>
      <td style="color:${netColor};font-weight:700;font-family:'JetBrains Mono',monospace">â‚¹${net.toLocaleString('en-IN')}</td>
      <td style="color:${netColor};font-weight:600">${margin}%</td>
    </tr>`;
  }).join('');

  // Revenue bar chart
  const rc = document.getElementById('revenueChart');
  if (rc) buildBarChart(rc, REVENUE_CHART_DATA, 'green');
}
renderAnalytics();

function exportCSV() {
  const rows = [['Vehicle','Revenue','Fuel','Maintenance','ROI%']];
  ROI_DATA.forEach(r => {
    const roi = (((r.rev-r.fuel-r.maint)/r.acq)*100).toFixed(1);
    rows.push([r.vehicle,r.rev,r.fuel,r.maint,roi]);
  });
  const csv = rows.map(r=>r.join(',')).join('\n');
  const a = document.createElement('a');
  a.href = 'data:text/csv;charset=utf-8,'+encodeURIComponent(csv);
  a.download = 'FleetFlow_ROI_Report.csv';
  a.click();
  toast('CSV exported successfully');
}

function exportPDF() {
  window.print();
  toast('Print/Save as PDF dialog opened');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SAFETY PAGE DATA & RENDER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const LICENSE_DATA = [
  {name:'Vikram Singh', id:'DRV-005', license:'DL-RJ-2014-0034521', cat:'HMV', expiry:'2025-02-28', status:'expiring'},
  {name:'Kiran Bhat',   id:'DRV-006', license:'DL-KA-2019-0087432', cat:'LMV', expiry:'2025-03-10', status:'expiring'},
  {name:'Ramesh Kumar', id:'DRV-007', license:'DL-GJ-2012-0065128', cat:'HMV', expiry:'2025-03-18', status:'expiring'},
  {name:'Arjun Mehta',  id:'DRV-001', license:'DL-MH-2017-0023411', cat:'HMV', expiry:'2027-08-15', status:'valid'},
  {name:'Priya Shah',   id:'DRV-002', license:'DL-MH-2020-0041287', cat:'LMV', expiry:'2028-11-22', status:'valid'},
  {name:'Rohan Das',    id:'DRV-003', license:'DL-GJ-2018-0056743', cat:'HMV', expiry:'2026-05-30', status:'valid'},
  {name:'Deepa Nair',   id:'DRV-008', license:'DL-KL-2021-0012345', cat:'LMV', expiry:'2024-12-01', status:'expired'},
];
const SAFETY_SCORES = [
  {name:'Priya Shah',   score:96, color:'#22c55e', trips:211},
  {name:'Deepa Nair',   score:94, color:'#22c55e', trips:89},
  {name:'Kiran Bhat',   score:91, color:'#22c55e', trips:144},
  {name:'Arjun Mehta',  score:88, color:'#3b82f6', trips:284},
  {name:'Sneha Patel',  score:84, color:'#3b82f6', trips:156},
  {name:'Rohan Das',    score:79, color:'#f59e0b', trips:198},
  {name:'Vikram Singh', score:68, color:'#f59e0b', trips:312},
  {name:'Ramesh Kumar', score:55, color:'#ef4444', trips:267},
];
const INCIDENTS_DATA = [
  {date:'18 Feb',driver:'Vikram Singh', vehicle:'RJ-14-XY-0099',type:'Speeding',severity:'medium',status:'open'},
  {date:'14 Feb',driver:'Rohan Das',    vehicle:'GJ-05-EF-9012',type:'Route Deviation',severity:'low',status:'open'},
  {date:'05 Feb',driver:'Ramesh Kumar', vehicle:'GJ-01-MN-8899',type:'Minor Collision',severity:'high',status:'resolved'},
  {date:'28 Jan',driver:'Ramesh Kumar', vehicle:'GJ-01-MN-8899',type:'Traffic Violation',severity:'medium',status:'resolved'},
];

function renderSafety() {
  // License table
  const today = new Date();
  document.getElementById('licenseTable').innerHTML = LICENSE_DATA.map(l => {
    const exp = new Date(l.expiry);
    const daysLeft = Math.ceil((exp-today)/(1000*60*60*24));
    const isExpired = daysLeft < 0;
    const isExpiring = daysLeft >= 0 && daysLeft <= 30;
    const statusPill = isExpired
      ? '<span class="pill pill-red">Expired</span>'
      : isExpiring
        ? `<span class="pill pill-amber">Exp. in ${daysLeft}d</span>`
        : '<span class="pill pill-green">Valid</span>';
    const fmtDate = exp.toLocaleDateString('en-IN',{day:'2-digit',month:'short',year:'numeric'});
    const blocked = isExpired ? '<span class="badge badge-red" style="font-size:10px">BLOCKED</span>' : '';
    return `<tr>
      <td class="td-name">${l.name} ${blocked}</td>
      <td class="td-mono" style="font-size:11px">${l.license}</td>
      <td><span class="badge badge-gray">${l.cat}</span></td>
      <td style="font-size:12px;color:${isExpired?'#ef4444':isExpiring?'#f59e0b':'#94a3b8'};font-family:'JetBrains Mono',monospace">${fmtDate}</td>
      <td>${statusPill}</td>
      <td><button class="btn btn-ghost btn-sm">Renew</button></td>
    </tr>`;
  }).join('');

  // Safety scores
  const scoreEl = document.getElementById('safetyScoreList');
  scoreEl.innerHTML = SAFETY_SCORES.map(s => `
    <div style="padding:10px 0;border-bottom:1px solid rgba(255,255,255,0.04)">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:7px">
        <div style="font-size:13px;font-weight:600;color:var(--text1)">${s.name}</div>
        <span style="font-size:14px;font-weight:800;color:${s.color};font-family:'JetBrains Mono',monospace">${s.score}/100</span>
      </div>
      <div class="prog-track"><div class="prog-fill" data-w="${s.score}%" style="background:linear-gradient(90deg,${s.color},${s.color}88);transition-delay:0.4s"></div></div>
      <div style="font-size:11px;color:var(--text3);margin-top:5px">${s.trips} trips completed</div>
    </div>`).join('');
  setTimeout(() => {
    scoreEl.querySelectorAll('.prog-fill').forEach(el => { el.style.width='0'; setTimeout(()=> el.style.width=el.dataset.w, 100); });
  }, 200);

  // Incidents table
  const sevPill = {low:'pill-green',medium:'pill-amber',high:'pill-red'};
  document.getElementById('incidentTable').innerHTML = INCIDENTS_DATA.map(inc => `
    <tr>
      <td style="color:#475569;font-size:12px;font-family:'JetBrains Mono',monospace">${inc.date}</td>
      <td class="td-name">${inc.driver}</td>
      <td class="td-mono" style="font-size:12px">${inc.vehicle}</td>
      <td>${inc.type}</td>
      <td><span class="pill ${sevPill[inc.severity]}">${inc.severity.charAt(0).toUpperCase()+inc.severity.slice(1)}</span></td>
      <td><span class="pill ${inc.status==='open'?'pill-amber':'pill-green'}">${inc.status==='open'?'Open':'Resolved'}</span></td>
    </tr>`).join('');
}
renderSafety();

/* â”€â”€â”€ Submit Incident â”€â”€â”€ */
function submitIncident() {
  const driver = gv('inc-driver'); const vehicle = gv('inc-vehicle');
  const type = gv('inc-type') || 'Minor Collision';
  const severity = document.getElementById('inc-severity')?.value || 'low';
  const date = gv('inc-date'); const loc = gv('inc-location');
  if (!driver || !vehicle) { toast('Driver and vehicle are required','error'); return; }
  const fmtDate = date ? new Date(date).toLocaleDateString('en-IN',{day:'2-digit',month:'short'}) : 'Today';
  INCIDENTS_DATA.unshift({date:fmtDate,driver,vehicle,type,severity,status:'open'});
  // Deduct safety score
  const drv = SAFETY_SCORES.find(s=>s.name===driver);
  if (drv) drv.score = Math.max(0, drv.score - (severity==='high'?15:severity==='medium'?8:3));
  ACTIVITY.unshift({icon:'âš ï¸',text:`Incident logged: ${driver} â€” ${type}`,time:'Just now',color:'#ef4444'});
  renderSafety();
  rebuildDash();
  closeModal('modal-log-incident');
  toast('Incident logged for '+driver, 'error');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROFILE PICTURE POPUP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const STICKERS = ['ğŸ˜','ğŸš€','ğŸ¦…','ğŸ”¥','âš¡','ğŸï¸','ğŸ›¡ï¸','ğŸ¯','ğŸ’','ğŸº','ğŸ¦','ğŸ‰','ğŸ‘‘','ğŸ¤–','ğŸ©','ğŸ§¢','ğŸŒŸ','ğŸª','âš“','ğŸ','ğŸ§‘â€âœˆï¸','ğŸ‘¨â€ğŸ’¼','ğŸ‘©â€ğŸ’¼','ğŸ§‘â€ğŸ”§'];
const GRADIENTS = [
  {label:'Ocean',  g:['#3b82f6','#8b5cf6']},
  {label:'Forest', g:['#22c55e','#06b6d4']},
  {label:'Sunset', g:['#ec4899','#f59e0b']},
  {label:'Fire',   g:['#f59e0b','#ef4444']},
  {label:'Arctic', g:['#06b6d4','#3b82f6']},
  {label:'Candy',  g:['#8b5cf6','#ec4899']},
  {label:'Lava',   g:['#ef4444','#f97316']},
  {label:'Mint',   g:['#14b8a6','#22c55e']},
];
let _picChoice = { type:'initials', value:null, grad:GRADIENTS[0].g };
let _stickerBuilt = false, _gradBuilt = false;

function setPicTab(btn, tab) {
  document.querySelectorAll('#picTabs .filter-tab').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('.pic-tab-panel').forEach(p => p.style.display='none');
  btn.classList.add('active');
  document.getElementById('picTab-'+tab).style.display = '';
  // Build lazy content
  if (tab === 'stickers' && !_stickerBuilt) { buildStickerGrid(); _stickerBuilt = true; }
  if (tab === 'gradient'  && !_gradBuilt)   { buildGradientPicker(); _gradBuilt = true; }
}

function buildStickerGrid() {
  const sg = document.getElementById('stickerGrid');
  sg.innerHTML = '';
  STICKERS.forEach(s => {
    const btn = document.createElement('div');
    btn.textContent = s;
    btn.style.cssText = 'font-size:22px;text-align:center;padding:8px;border-radius:8px;cursor:pointer;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.07);transition:all 0.15s;user-select:none';
    btn.addEventListener('mouseenter', () => btn.style.cssText += 'background:rgba(59,130,246,0.15);transform:scale(1.15)');
    btn.addEventListener('mouseleave', () => { btn.style.background='rgba(255,255,255,0.04)'; btn.style.transform='scale(1)'; });
    btn.addEventListener('click', () => {
      sg.querySelectorAll('div').forEach(b => b.style.borderColor='rgba(255,255,255,0.07)');
      btn.style.borderColor='#3b82f6';
      _picChoice = {type:'sticker', value:s, grad:_picChoice.grad};
      applyPicPreview(_picChoice);
    });
    sg.appendChild(btn);
  });
}

function buildGradientPicker() {
  const gp = document.getElementById('gradientPicker');
  gp.innerHTML = '';
  GRADIENTS.forEach(({label, g}) => {
    const wrap = document.createElement('div');
    wrap.style.cssText = 'display:flex;flex-direction:column;align-items:center;gap:6px;cursor:pointer';
    const circle = document.createElement('div');
    circle.style.cssText = `width:52px;height:52px;border-radius:50%;background:linear-gradient(135deg,${g[0]},${g[1]});border:3px solid transparent;transition:all 0.18s;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;color:#fff`;
    circle.textContent = document.getElementById('picPreviewInitials')?.textContent || 'AM';
    const lbl = document.createElement('div');
    lbl.textContent = label;
    lbl.style.cssText = 'font-size:10px;color:var(--text3)';
    wrap.appendChild(circle); wrap.appendChild(lbl);
    wrap.addEventListener('mouseenter', () => circle.style.borderColor='rgba(255,255,255,0.6)');
    wrap.addEventListener('mouseleave', () => { if(_picChoice.grad!==g) circle.style.borderColor='transparent'; });
    wrap.addEventListener('click', () => {
      gp.querySelectorAll('div>div:first-child').forEach(c => c.style.borderColor='transparent');
      circle.style.borderColor='#fff';
      _picChoice.grad = g;
      if (_picChoice.type!=='image' && _picChoice.type!=='url') _picChoice.type='initials';
      applyPicPreview(_picChoice);
    });
    gp.appendChild(wrap);
  });
}

function previewUrlPic(url) {
  if (!url || !url.startsWith('http')) return;
  const thumb = document.getElementById('urlPreviewThumb');
  const img   = document.getElementById('urlThumbImg');
  img.onload  = () => { thumb.style.display='block'; _picChoice={type:'url',value:url,grad:_picChoice.grad}; applyPicPreview(_picChoice); };
  img.onerror = () => { thumb.style.display='none'; toast('Could not load image â€” try a direct image URL ending in .jpg or .png','error'); };
  img.src = url;
}

function openProfilePicModal() {
  const initEl = document.getElementById('picPreviewInitials');
  const nameEl = document.getElementById('picPreviewName');
  const sideInit = document.getElementById('sidebarAvatar');
  const sideName = document.getElementById('sidebarName');
  if (initEl && sideInit) initEl.textContent = sideInit.textContent;
  if (nameEl && sideName) nameEl.textContent = sideName.textContent;
  const saved = localStorage.getItem('ff_profile_pic');
  if (saved) { try { _picChoice = JSON.parse(saved); applyPicPreview(_picChoice); } catch(e){} }
  // Reset to upload tab
  const firstTab = document.querySelector('#picTabs .filter-tab');
  if (firstTab) setPicTab(firstTab, 'upload');
  openModal('modal-profile-pic');
}

function applyPicPreview(choice) {
  const wrap   = document.getElementById('picPreviewWrap');
  const initEl = document.getElementById('picPreviewInitials');
  const imgEl  = document.getElementById('picPreviewImg');
  if (!wrap) return;
  const [g1, g2] = choice.grad || GRADIENTS[0].g;
  if (choice.type === 'image' || choice.type === 'url') {
    imgEl.src = choice.value;
    imgEl.style.display = 'block';
    initEl.style.display = 'none';
    wrap.style.background = 'none';
  } else {
    imgEl.style.display = 'none';
    initEl.style.display = '';
    wrap.style.background = `linear-gradient(135deg,${g1},${g2})`;
    initEl.textContent = choice.type === 'sticker'
      ? choice.value
      : (document.getElementById('sidebarAvatar')?.textContent || 'AM');
    initEl.style.fontSize = choice.type === 'sticker' ? '32px' : '26px';
  }
}

function handlePicUpload(input) {
  const file = input.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    _picChoice = {type:'image', value:e.target.result, grad:_picChoice.grad};
    applyPicPreview(_picChoice);
  };
  reader.readAsDataURL(file);
}

function saveProfilePic() {
  localStorage.setItem('ff_profile_pic', JSON.stringify(_picChoice));
  const [g1, g2] = _picChoice.grad || GRADIENTS[0].g;
  // Helper to apply to any avatar element
  function applyToEl(el) {
    if (!el) return;
    if (_picChoice.type === 'image' || _picChoice.type === 'url') {
      el.innerHTML = `<img src="${_picChoice.value}" style="width:100%;height:100%;object-fit:cover;border-radius:50%">`;
      el.style.background = 'none'; el.style.fontSize = '';
    } else if (_picChoice.type === 'sticker') {
      el.innerHTML = ''; el.textContent = _picChoice.value;
      el.style.background = `linear-gradient(135deg,${g1},${g2})`;
      el.style.fontSize = '18px';
    } else {
      // initials â€” restore textContent
      const cur = el.textContent;
      el.innerHTML = ''; el.textContent = cur;
      el.style.background = `linear-gradient(135deg,${g1},${g2})`;
      el.style.fontSize = '';
    }
  }
  applyToEl(document.getElementById('sidebarAvatar'));
  applyToEl(document.getElementById('dropupAvatar'));
  applyToEl(document.querySelector('#settings-profile .avatar'));
  closeModal('modal-profile-pic');
  toast('Profile picture updated! ğŸ‰');
}

// Restore saved pic on load
(function restorePic() {
  try {
    const saved = localStorage.getItem('ff_profile_pic');
    if (!saved) return;
    _picChoice = JSON.parse(saved);
    const [g1,g2] = _picChoice.grad || GRADIENTS[0].g;
    ['sidebarAvatar','dropupAvatar'].forEach(id => {
      const el = document.getElementById(id);
      if (!el) return;
      if (_picChoice.type === 'image' || _picChoice.type === 'url') {
        el.innerHTML = `<img src="${_picChoice.value}" style="width:100%;height:100%;object-fit:cover;border-radius:50%">`;
        el.style.background = 'none';
      } else if (_picChoice.type === 'sticker') {
        el.textContent = _picChoice.value;
        el.style.background = `linear-gradient(135deg,${g1},${g2})`;
        el.style.fontSize = '18px';
      } else {
        el.style.background = `linear-gradient(135deg,${g1},${g2})`;
      }
    });
  } catch(e) {}
})();
/* â•â•â•â•â•â•â•â•â• THEME SYSTEM â•â•â•â•â•â•â•â•â• */

function applyTheme(theme) {
  document.documentElement.setAttribute('data-theme', theme);
  localStorage.setItem('ff_theme', theme);
}

function initTheme() {
  const saved = localStorage.getItem('ff_theme') || 'dark';
  applyTheme(saved);

  const toggle = document.querySelector('#themeToggle');
  if (toggle) toggle.checked = saved === 'light';
}

function toggleTheme(el) {
  const theme = el.checked ? 'light' : 'dark';
  applyTheme(theme);
}

initTheme();

</script>
</body>
</html>